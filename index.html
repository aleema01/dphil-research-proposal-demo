<!-- GitHub Pages rebuild -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flood Forecasting AI Assistant - DPhil Research Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root {
            --primary-blue: #1a5f7a;
            --secondary-blue: #57c5b6;
            --accent-green: #7fcd91;
            --warning-red: #e63946;
            --alert-orange: #ff9800;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
            --medium-gray: #6c757d;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-text);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-blue), #2a8dad);
            color: white;
            padding: 25px 0;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 700px;
        }
        
        .demo-badge {
            background-color: var(--accent-green);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(127, 205, 145, 0.3);
        }
        
        /* Region Selection Bar */
        .region-selection {
            background-color: white;
            border-radius: 12px;
            padding: 15px 25px;
            margin: 20px 0 30px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .region-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .region-label {
            font-weight: 600;
            color: var(--primary-blue);
            white-space: nowrap;
        }
        
        .region-select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background-color: white;
            font-weight: 500;
            color: var(--dark-text);
            min-width: 180px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .region-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(26, 95, 122, 0.1);
        }
        
        .selected-region-display {
            background-color: rgba(26, 95, 122, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--primary-blue);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-tabs {
            display: flex;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 18px 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 4px solid transparent;
            min-width: 140px;
        }
        
        .tab:hover {
            background-color: rgba(26, 95, 122, 0.05);
        }
        
        .tab.active {
            color: var(--primary-blue);
            border-bottom: 4px solid var(--primary-blue);
            background-color: rgba(26, 95, 122, 0.08);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            color: var(--primary-blue);
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.4rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 4px solid var(--primary-blue);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.3rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 10px;
        }
        
        .data-point {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .data-point:last-child {
            border-bottom: none;
        }
        
        .data-label {
            font-weight: 500;
        }
        
        .data-value {
            font-weight: 600;
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
            position: relative;
        }
        
        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .warning-messages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .warning-card {
            padding: 25px;
            border-radius: 12px;
            border-left: 6px solid;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .warning-basic {
            background-color: rgba(255, 193, 7, 0.1);
            border-left-color: #ffc107;
        }
        
        .warning-impact {
            background-color: rgba(255, 87, 51, 0.1);
            border-left-color: #ff5733;
        }
        
        .warning-financial {
            background-color: rgba(57, 192, 237, 0.1);
            border-left-color: #39c0ed;
        }
        
        .warning-title {
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 1.2rem;
        }
        
        .warning-title i {
            margin-right: 10px;
        }
        
        .simulation-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #14455c;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #545b62;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background-color: var(--warning-red);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            text-align: center;
            padding: 25px;
            border-radius: 12px;
            background-color: white;
            box-shadow: var(--card-shadow);
            border-top: 4px solid var(--secondary-blue);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .metric-label {
            color: var(--medium-gray);
            font-size: 0.95rem;
        }
        
        .improvement {
            color: #28a745;
        }
        
        .decline {
            color: var(--warning-red);
        }
        
        .fl-data-nodes {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            gap: 20px;
        }
        
        .fl-node {
            text-align: center;
            padding: 25px;
            border-radius: 12px;
            background-color: white;
            box-shadow: var(--card-shadow);
            width: 30%;
            transition: all 0.3s;
            border-top: 4px solid transparent;
        }
        
        .fl-node.active {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--secondary-blue);
        }
        
        .fl-node-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-blue);
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--medium-gray);
            font-size: 0.9rem;
            border-top: 1px solid #dee2e6;
            margin-top: 50px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background-color: #28a745;
        }
        
        .status-inactive {
            background-color: #6c757d;
        }
        
        .status-training {
            background-color: #ffc107;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .ai-report {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--secondary-blue);
        }
        
        .ai-report-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .ai-report-title i {
            margin-right: 10px;
        }
        
        .ai-report-content {
            line-height: 1.8;
        }
        
        .alert-box {
            background-color: rgba(255, 193, 7, 0.1);
            border-left: 6px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .alert-box i {
            font-size: 1.8rem;
            color: #ffc107;
        }
        
        .alert-box.warning {
            background-color: rgba(230, 57, 70, 0.1);
            border-left-color: var(--warning-red);
        }
        
        .alert-box.warning i {
            color: var(--warning-red);
        }
        
        .simple-explanation {
            background-color: rgba(87, 197, 182, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary-blue);
        }
        
        .simple-explanation h4 {
            color: var(--primary-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .simple-explanation h4 i {
            margin-right: 10px;
        }
        
        .map-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 300px;
        }
        
        .map-controls-sidebar {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .map-legend-sidebar {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .map-with-controls {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .map-main {
            flex: 1;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .flood-risk-high {
            background-color: rgba(230, 57, 70, 0.7);
        }
        
        .flood-risk-medium {
            background-color: rgba(255, 152, 0, 0.7);
        }
        
        .flood-risk-low {
            background-color: rgba(87, 197, 182, 0.7);
        }
        
        .building-exposure {
            background-color: rgba(87, 87, 237, 0.7);
        }
        
        .flood-extent {
            background-color: rgba(0, 100, 255, 0.7);
        }
        
        .map-control-btn {
            width: 100%;
            background-color: white;
            border: 2px solid #dee2e6;
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            text-align: left;
        }
        
        .map-control-btn:hover {
            background-color: #f8f9fa;
            border-color: var(--primary-blue);
        }
        
        .map-control-btn.active {
            background-color: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }
        
        .flood-depth-visualization {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .real-time-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--primary-blue);
            font-weight: 600;
        }
        
        .blinking-dot {
            width: 10px;
            height: 10px;
            background-color: #28a745;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .report-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f9fa;
        }
        
        .report-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .report-section h4 {
            color: var(--primary-blue);
            margin-bottom: 15px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .data-table th {
            background-color: rgba(26, 95, 122, 0.1);
            color: var(--primary-blue);
            font-weight: 600;
        }
        
        .data-table tr:hover {
            background-color: rgba(26, 95, 122, 0.05);
        }
        
        .geocode-result {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--secondary-blue);
        }
        
        .data-source-badge {
            display: inline-block;
            background-color: rgba(87, 197, 182, 0.2);
            color: var(--primary-blue);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .data-refresh {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: rgba(26, 95, 122, 0.05);
            border-radius: 8px;
        }
        
        .refresh-time {
            font-size: 0.9rem;
            color: var(--medium-gray);
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .status-online {
            color: #28a745;
        }
        
        .status-offline {
            color: #dc3545;
        }
        
        /* Report Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 1000px;
            border-radius: 10px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }
        
        .detailed-report {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .detailed-report .report-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .detailed-report h4 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .detailed-report h4 i {
            margin-right: 10px;
        }
        
        .report-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .highlight-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-blue);
            text-align: center;
        }
        
        .highlight-box h5 {
            color: var(--primary-blue);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .highlight-box p {
            margin: 5px 0;
        }
        
        .highlight-box p strong {
            font-size: 1.5rem;
            color: var(--primary-blue);
        }
        
        .report-data-point {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .report-data-point:last-child {
            border-bottom: none;
        }
        
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .recommendation-card {
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .recommendation-card.immediate {
            border-left: 4px solid var(--warning-red);
        }
        
        .recommendation-card.short-term {
            border-left: 4px solid var(--alert-orange);
        }
        
        .recommendation-card.medium-term {
            border-left: 4px solid #ffc107;
        }
        
        .recommendation-card.long-term {
            border-left: 4px solid #28a745;
        }
        
        .recommendation-card h5 {
            color: var(--primary-blue);
            margin-bottom: 10px;
        }
        
        .recommendation-card ul {
            padding-left: 20px;
        }
        
        .recommendation-card li {
            margin-bottom: 5px;
        }
        
        .report-actions {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .report-actions h5 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .report-actions h5 i {
            margin-right: 10px;
        }
        
        .report-actions ol {
            padding-left: 20px;
        }
        
        .report-actions li {
            margin-bottom: 10px;
        }
        
        .report-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
            font-size: 0.9rem;
            color: var(--medium-gray);
        }

        /* ADM Explanation */
        .adm-explanation {
            background-color: rgba(26, 95, 122, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--primary-blue);
        }
        
        .adm-explanation h5 {
            color: var(--primary-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .adm-explanation h5 i {
            margin-right: 10px;
        }
        
        .adm-levels {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .adm-level {
            padding: 10px 15px;
            background-color: white;
            border-radius: 6px;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }
        
        .adm-level.adm0 { border-top: 3px solid #e63946; }
        .adm-level.adm1 { border-top: 3px solid #1a5f7a; }
        .adm-level.adm2 { border-top: 3px solid #57c5b6; }
        .adm-level.adm3 { border-top: 3px solid #7fcd91; }
        
        /* Flood Flow Visualization */
        .flood-flow-container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--secondary-blue);
        }
        
        .flood-flow-visual {
            width: 100%;
            height: 200px;
            position: relative;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .flow-path {
            position: absolute;
            width: 100%;
            height: 30px;
            background: linear-gradient(to right, #57c5b6, #1a5f7a, #0066ff);
            bottom: 50px;
            border-radius: 15px;
            animation: flowAnimation 3s infinite linear;
        }
        
        .flow-arrow {
            position: absolute;
            font-size: 24px;
            color: var(--primary-blue);
            animation: moveArrow 3s infinite linear;
        }
        
        @keyframes flowAnimation {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        @keyframes moveArrow {
            0% { left: 0%; transform: translateX(0); }
            100% { left: 100%; transform: translateX(-100%); }
        }
        
        .flow-point {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            z-index: 2;
        }
        
        .flow-point.upstream { background-color: #57c5b6; top: 30px; left: 10%; }
        .flow-point.midstream { background-color: #1a5f7a; top: 60px; left: 50%; }
        .flow-point.downstream { background-color: #0066ff; top: 90px; left: 80%; }
        
        .flow-label {
            position: absolute;
            font-size: 0.9rem;
            color: var(--primary-blue);
            font-weight: 600;
        }
        
        .upstream-label { top: 10px; left: 10%; }
        .midstream-label { top: 40px; left: 50%; }
        .downstream-label { top: 70px; left: 80%; }
        
        .flow-explanation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .flow-step {
            flex: 1;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            min-width: 200px;
        }
        
        .flow-step h5 {
            color: var(--primary-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .flow-step h5 i {
            margin-right: 10px;
        }
        
        /* Enhanced Charts */
        .chart-explanation {
            background-color: rgba(87, 197, 182, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--secondary-blue);
        }
        
        .chart-tips {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .chart-tip {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            border-top: 3px solid var(--secondary-blue);
        }
        
        /* Sticker Icons */
        .sticker {
            display: inline-block;
            font-size: 2rem;
            margin: 0 5px;
            vertical-align: middle;
        }
        
        /* Pathway Maps */
        .pathway-map {
            width: 100%;
            height: 300px;
            background-color: #f8f9fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .river-path {
            position: absolute;
            width: 80%;
            height: 50px;
            background: linear-gradient(to right, #57c5b6, #1a5f7a);
            top: 50%;
            left: 10%;
            border-radius: 25px;
            opacity: 0.7;
        }
        
        .flood-zone {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(0, 100, 255, 0.3);
            border: 2px dashed rgba(0, 100, 255, 0.6);
        }
        
        .zone-label {
            position: absolute;
            background-color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-blue);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .zone-1 { width: 100px; height: 100px; top: 20%; left: 15%; }
        .zone-2 { width: 120px; height: 120px; top: 60%; left: 40%; }
        .zone-3 { width: 80px; height: 80px; top: 30%; left: 70%; }
        
        .label-1 { top: 15%; left: 20%; }
        .label-2 { top: 65%; left: 45%; }
        .label-3 { top: 25%; left: 75%; }
        
        /* Enhanced Tooltips */
        .tooltip-explanation {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--primary-blue);
            cursor: help;
        }
        
        .tooltip-explanation .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: var(--primary-blue);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip-explanation:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(26, 95, 122, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error States */
        .error-message {
            background-color: rgba(230, 57, 70, 0.1);
            border-left: 4px solid var(--warning-red);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .error-message i {
            color: var(--warning-red);
            font-size: 1.5rem;
        }
        
        /* Success States */
        .success-message {
            background-color: rgba(87, 197, 182, 0.1);
            border-left: 4px solid var(--secondary-blue);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .success-message i {
            color: var(--secondary-blue);
            font-size: 1.5rem;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .map-with-controls {
                flex-direction: column;
            }
            
            .map-sidebar {
                width: 100%;
            }
            
            .building-visualization {
                grid-template-columns: 1fr;
            }
            
            .flood-flow-container {
                padding: 15px;
            }
            
            .flow-explanation {
                flex-direction: column;
            }
            
            .adm-levels {
                flex-direction: column;
            }
            
            .chart-tips {
                flex-direction: column;
            }
            
            .tooltip-explanation .tooltiptext {
                width: 250px;
                margin-left: -125px;
            }
        }
        
        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: row;
                overflow-x: auto;
            }
            
            .tab {
                min-width: 120px;
                white-space: nowrap;
            }
            
            .fl-data-nodes {
                flex-direction: column;
                gap: 20px;
            }
            
            .fl-node {
                width: 100%;
            }
            
            .warning-messages {
                grid-template-columns: 1fr;
            }
            
            .region-selection {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .region-group {
                width: 100%;
            }
            
            .region-select {
                flex: 1;
            }
        }
        
        /* Print Styles */
        @media print {
            .floating-ai-assistant,
            .ai-chat-box,
            .simulation-controls button:not(.print-important),
            .map-controls {
                display: none !important;
            }
            
            .tab-content {
                box-shadow: none;
                border: 1px solid #dee2e6;
            }
            
            .chart-container {
                height: 250px;
            }
        }
        
        .building-visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .visualization-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border-top: 4px solid var(--secondary-blue);
        }
        
        .visualization-title {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }
        
        .visualization-title i {
            margin-right: 10px;
        }
        
        .flood-visual {
            position: relative;
            width: 100%;
            height: 250px;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
            background: linear-gradient(to bottom, #57c5b6, #1a5f7a);
        }
        
        .flood-depth-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background-color: rgba(0, 100, 255, 0.6);
            transition: height 0.5s ease;
        }
        
        .flood-label {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            z-index: 2;
            font-weight: bold;
        }
        
        .building-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .building-stat {
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-blue);
        }
        
        .building-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }
        
        .building-stat-label {
            font-size: 0.9rem;
            color: var(--medium-gray);
        }
        
        .depth-slider-container {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slider-label span {
            font-weight: 600;
            color: var(--primary-blue);
        }
        
        .depth-slider {
            width: 100%;
            height: 20px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #57c5b6, #ffc107, #e63946);
            outline: none;
            border-radius: 10px;
        }
        
        .depth-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        
        .building-type-breakdown {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .building-type {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            min-width: 150px;
        }
        
        .building-type.residential {
            background-color: rgba(87, 197, 182, 0.2);
            border-left: 4px solid #57c5b6;
        }
        
        .building-type.commercial {
            background-color: rgba(255, 152, 0, 0.2);
            border-left: 4px solid #ff9800;
        }
        
        .building-type.industrial {
            background-color: rgba(108, 117, 125, 0.2);
            border-left: 4px solid #6c757d;
        }
        
        .building-type.public {
            background-color: rgba(57, 192, 237, 0.2);
            border-left: 4px solid #39c0ed;
        }
        
        .floating-ai-assistant {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-blue);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .floating-ai-assistant:hover {
            transform: scale(1.1);
            background-color: #14455c;
        }
        
        .ai-chat-box {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            display: none;
            overflow: hidden;
        }
        
        .ai-chat-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .ai-chat-body {
            padding: 20px;
            height: 300px;
            overflow-y: auto;
        }
        
        .ai-message {
            background-color: #f1f3f4;
            padding: 12px 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            max-width: 85%;
        }
        
        .user-message {
            background-color: var(--secondary-blue);
            color: white;
            margin-left: auto;
            max-width: 85%;
        }
        
        .ai-chat-input {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }
        
        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        /* ANALYTICAL GRAPHS CSS */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .analytics-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            border-top: 4px solid var(--secondary-blue);
        }
        
        .stacked-chart-container {
            height: 250px;
            margin: 15px 0;
        }
        
        /* EVACUATION PLANNING CSS */
        .flowchart-container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--warning-red);
        }
        
        .flowchart {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 30px 0;
        }
        
        .flowchart-step {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            width: 80%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid var(--primary-blue);
            text-align: center;
            position: relative;
            z-index: 2;
        }
        
        .flowchart-arrow {
            width: 2px;
            height: 30px;
            background-color: var(--primary-blue);
            position: relative;
            z-index: 1;
        }
        
        .flowchart-arrow::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 12px solid var(--primary-blue);
        }
        
        .evacuation-output {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid var(--alert-orange);
        }
        
        .evacuation-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .evacuation-metric {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .priority-high {
            background-color: rgba(230, 57, 70, 0.1);
            border-left: 4px solid var(--warning-red);
        }
        
        .priority-medium {
            background-color: rgba(255, 152, 0, 0.1);
            border-left: 4px solid var(--alert-orange);
        }
        
        .priority-low {
            background-color: rgba(87, 197, 182, 0.1);
            border-left: 4px solid var(--secondary-blue);
        }
        
        /* Extended AI Reports CSS */
        .highlight-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 6px solid var(--primary-blue);
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .matrix-table th, .matrix-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .matrix-table th {
            background-color: rgba(26, 95, 122, 0.1);
            font-weight: 600;
        }
        
        .risk-high { background-color: rgba(230, 57, 70, 0.2); }
        .risk-medium { background-color: rgba(255, 152, 0, 0.2); }
        .risk-low { background-color: rgba(87, 197, 182, 0.2); }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1><span class="sticker">ðŸŒŠ</span> Flood Forecasting AI Assistant</h1>
                    <p class="subtitle">DPhil Research Prototype: Federated Learning for Transboundary Flood Warnings in the GBM Basin</p>
                </div>
                <div class="demo-badge">
                    <i class="fas fa-robot"></i> REAL-TIME SIMULATION
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Region Selection Bar -->
        <div class="region-selection">
            <div class="region-group">
                <span class="region-label"><i class="fas fa-water"></i> Select Sub-Basin:</span>
                <select id="subBasinSelect" class="region-select">
                    <option value="ganga">Ganga Basin</option>
                    <option value="brahmaputra">Brahmaputra Basin</option>
                    <option value="meghna">Meghna Basin</option>
                    <option value="all">All GBM Basins</option>
                </select>
            </div>
            
            <div class="region-group">
                <span class="region-label"><i class="fas fa-globe-asia"></i> Select Country:</span>
                <select id="countrySelect" class="region-select">
                    <option value="india">India</option>
                    <option value="bangladesh">Bangladesh</option>
                    <option value="nepal">Nepal</option>
                    <option value="all">All Countries</option>
                </select>
            </div>
            
            <div class="selected-region-display" id="currentSelectionDisplay">
                <i class="fas fa-map-marker-alt"></i>
                <span id="currentSelectionText">Ganga Basin, India</span>
            </div>
            
            <button class="btn btn-primary" id="applyRegionFilter">
                <i class="fas fa-filter"></i> Apply Filter
            </button>
        </div>
        
        <!-- ADM Explanation -->
        <div class="adm-explanation">
            <h5><i class="fas fa-info-circle"></i> What do ADM levels mean?</h5>
            <p><strong>ADM (Administrative Division)</strong> refers to how countries organize their regions. This system helps us analyze floods at different scales:</p>
            <div class="adm-levels">
                <div class="adm-level adm0">
                    <strong>ADM0</strong><br>
                    <small>Country Level</small>
                </div>
                <div class="adm-level adm1">
                    <strong>ADM1</strong><br>
                    <small>State/Province</small>
                </div>
                <div class="adm-level adm2">
                    <strong>ADM2</strong><br>
                    <small>District/County</small>
                </div>
                <div class="adm-level adm3">
                    <strong>ADM3</strong><br>
                    <small>Municipality/Town</small>
                </div>
            </div>
        </div>
        
        <div class="data-refresh">
            <div class="real-time-indicator">
                <div class="blinking-dot"></div>
                <span>LIVE DATA STREAM ACTIVE</span>
            </div>
            <div class="refresh-time" id="refreshTime">Last updated: <span id="lastUpdate">Just now</span></div>
            <div class="api-status">
                <i class="fas fa-circle status-online"></i>
                <span>All APIs: ONLINE</span>
            </div>
        </div>
        
        <div class="nav-tabs">
            <div class="tab active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i> Live Dashboard
            </div>
            <div class="tab" data-tab="map">
                <i class="fas fa-map"></i> Flood Visualization
            </div>
            <div class="tab" data-tab="analytical-graphs">
                <i class="fas fa-chart-bar"></i> Analytical Graphs
            </div>
            <div class="tab" data-tab="warnings">
                <i class="fas fa-bullhorn"></i> Warning System
            </div>
            <div class="tab" data-tab="buildings">
                <i class="fas fa-building"></i> Building Exposure
            </div>
            <div class="tab" data-tab="fl">
                <i class="fas fa-brain"></i> Federated Learning
            </div>
            <div class="tab" data-tab="evacuation">
                <i class="fas fa-people-carry"></i> Evacuation Planning
            </div>
            <div class="tab" data-tab="fairness">
                <i class="fas fa-balance-scale"></i> Fairness Analytics
            </div>
            <div class="tab" data-tab="reports">
                <i class="fas fa-file-alt"></i> AI Reports
            </div>
            <div class="tab" data-tab="data">
                <i class="fas fa-database"></i> Data Sources
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Live System Dashboard</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-info-circle"></i> How This Federated System Works</h4>
                <p>This prototype demonstrates a privacy-preserving AI system that predicts floods across the Ganges-Brahmaputra-Meghna (GBM) basin. Using federated learning, each country (India, Nepal, Bangladesh) trains models locally on their private data. Only model updates (not raw data) are shared, preserving data sovereignty while creating accurate basin-wide flood predictions.</p>
                <div class="chart-tips">
                    <div class="chart-tip">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Privacy Protected</strong><br>
                        No data leaves borders
                    </div>
                    <div class="chart-tip">
                        <i class="fas fa-brain"></i>
                        <strong>AI Collaboration</strong><br>
                        Models learn together
                    </div>
                    <div class="chart-tip">
                        <i class="fas fa-bell"></i>
                        <strong>Early Warnings</strong><br>
                        Faster alerts for all
                    </div>
                </div>
            </div>
            
            <div class="alert-box warning" id="activeAlert">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>ACTIVE FLOOD ALERT LEVEL 3:</strong> High flood risk detected in Northern Bangladesh (Kurigram district). Predicted flood depth: 2.1-2.4m within 48-72 hours. 85,200+ buildings at risk. Evacuation advisory issued for low-lying areas.
                </div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="accuracyMetric">94.2%</div>
                    <div class="metric-label">Federated Model Accuracy</div>
                    <div class="improvement"><i class="fas fa-arrow-up"></i> +3.1% from baseline</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="leadTimeMetric">42.5 hrs</div>
                    <div class="metric-label">Average Warning Lead Time</div>
                    <div class="improvement"><i class="fas fa-arrow-up"></i> +8.2 hrs improvement</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="buildingsMetric">85.2K</div>
                    <div class="metric-label">Buildings at Risk</div>
                    <div class="decline"><i class="fas fa-exclamation-triangle"></i> 18% of regional total</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="populationMetric">620M+</div>
                    <div class="metric-label">People Protected</div>
                    <div><i class="fas fa-users"></i> GBM Basin Population</div>
                </div>
            </div>
            
            <!-- Flood Flow Visualization -->
            <div class="flood-flow-container">
                <h3 class="card-title"><i class="fas fa-water"></i> How Flood Water Moves Through the Basin</h3>
                <p>This animation shows how flood waters typically flow from upstream to downstream areas:</p>
                
                <div class="flood-flow-visual">
                    <div class="flow-path"></div>
                    <div class="flow-arrow">âž¤</div>
                    
                    <div class="flow-point upstream">U</div>
                    <div class="flow-point midstream">M</div>
                    <div class="flow-point downstream">D</div>
                    
                    <div class="flow-label upstream-label">Upstream (Mountains)</div>
                    <div class="flow-label midstream-label">Midstream (Plains)</div>
                    <div class="flow-label downstream-label">Downstream (Delta)</div>
                </div>
                
                <div class="flow-explanation">
                    <div class="flow-step">
                        <h5><i class="fas fa-mountain"></i> Upstream Areas</h5>
                        <p><strong>Nepal & North India:</strong> Heavy rainfall and snowmelt in mountains create initial floodwaters that flow downstream.</p>
                    </div>
                    <div class="flow-step">
                        <h5><i class="fas fa-river"></i> Midstream Areas</h5>
                        <p><strong>Central India & Bangladesh:</strong> Rivers collect water from multiple tributaries, causing water levels to rise.</p>
                    </div>
                    <div class="flow-step">
                        <h5><i class="fas fa-water"></i> Downstream Areas</h5>
                        <p><strong>Bangladesh Delta:</strong> All waters converge here, often causing severe flooding in low-lying areas.</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-water"></i> Current Flood Situation</h3>
                    <div class="data-point">
                        <span class="data-label">Active Flood Warnings</span>
                        <span class="data-value" style="color: var(--warning-red);" id="activeWarnings">3 regions</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">People at Immediate Risk</span>
                        <span class="data-value" id="peopleRisk">~425,000</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Highest Predicted Flood Depth</span>
                        <span class="data-value" id="maxDepth">2.4 meters</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Most Vulnerable Area</span>
                        <span class="data-value" id="vulnerableArea">Char communities, Kurigram</span>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-satellite"></i> Data Feed Status</h3>
                    <div class="data-point">
                        <span class="data-label">Satellite Imagery</span>
                        <span class="data-value" style="color: #28a745;">LIVE (Sentinel-1)</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">River Gauge Stations</span>
                        <span class="data-value" style="color: #28a745;">87% reporting</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Rainfall Radar</span>
                        <span class="data-value" style="color: #28a745;">Active (IMD, BMD)</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Building Footprints</span>
                        <span class="data-value" style="color: #28a745;">Updated 2h ago</span>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-shield-alt"></i> Privacy Protection Status</h3>
                    <div class="data-point">
                        <span class="data-label">Data Sharing Between Countries</span>
                        <span class="data-value" style="color: #28a745;">Zero raw data</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Federated Learning Rounds</span>
                        <span class="data-value" id="flRounds">142 completed</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Model Differential Privacy</span>
                        <span class="data-value" style="color: #28a745;">Îµ=1.2 (strong)</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Countries Collaborating</span>
                        <span class="data-value">India, Nepal, Bangladesh</span>
                    </div>
                </div>
            </div>
            
            <div class="building-visualization">
                <div class="visualization-card">
                    <h3 class="visualization-title"><i class="fas fa-chart-line"></i> Flood Risk Timeline</h3>
                    <div class="chart-container">
                        <canvas id="riskTimelineChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>How to read this chart:</strong> The orange line shows how flood risk increases over time. Peak risk occurs in 48-72 hours. The blue line shows actual river water levels.</p>
                    </div>
                </div>
                
                <div class="visualization-card">
                    <h3 class="visualization-title"><i class="fas fa-ruler-combined"></i> Flood Depth Simulation</h3>
                    <div class="flood-visual">
                        <div class="flood-depth-indicator" id="floodDepthVisual" style="height: 60%;"></div>
                        <div class="flood-label" id="floodDepthLabel">Current: 1.8m (First floor level)</div>
                    </div>
                    <div class="depth-slider-container">
                        <div class="slider-label">
                            <span>Adjust Simulated Flood Depth:</span>
                            <span id="depthValue">1.8 meters</span>
                        </div>
                        <input type="range" min="0" max="30" value="18" class="depth-slider" id="depthSlider">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem;">
                            <span>0m (Safe)</span>
                            <span>1m (Knee)</span>
                            <span>2m (Roof)</span>
                            <span>3m (Severe)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pathway Map -->
            <div class="flood-flow-container">
                <h3 class="card-title"><i class="fas fa-map-marked-alt"></i> Flood Water Pathway Map</h3>
                <p>This simplified map shows how flood waters typically enter and spread through vulnerable areas:</p>
                
                <div class="pathway-map">
                    <div class="river-path"></div>
                    
                    <div class="flood-zone zone-1"></div>
                    <div class="flood-zone zone-2"></div>
                    <div class="flood-zone zone-3"></div>
                    
                    <div class="zone-label label-1">Entry Point 1<br><small>River overflow</small></div>
                    <div class="zone-label label-2">Entry Point 2<br><small>Drainage backflow</small></div>
                    <div class="zone-label label-3">Entry Point 3<br><small>Groundwater rise</small></div>
                </div>
                
                <div class="flow-explanation">
                    <div class="flow-step">
                        <h5><span class="sticker">ðŸ’§</span> River Overflow</h5>
                        <p>When rivers receive too much water from upstream, they overflow their banks, flooding nearby areas first.</p>
                    </div>
                    <div class="flow-step">
                        <h5><span class="sticker">ðŸ”„</span> Drainage Backflow</h5>
                        <p>Heavy rainfall overwhelms drainage systems, causing water to back up and flood streets and buildings.</p>
                    </div>
                    <div class="flow-step">
                        <h5><span class="sticker">ðŸ“ˆ</span> Groundwater Rise</h5>
                        <p>Persistent rain raises groundwater levels, causing flooding from below even without visible surface water.</p>
                    </div>
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="generateReport">
                    <i class="fas fa-file-pdf"></i> Generate Technical Report
                </button>
                <button class="btn btn-success" id="simulateFlood">
                    <i class="fas fa-cloud-rain"></i> Simulate New Flood Scenario
                </button>
                <button class="btn btn-warning" id="testWarnings">
                    <i class="fas fa-bullhorn"></i> Test Warning Protocols
                </button>
                <button class="btn btn-secondary" id="refreshData">
                    <i class="fas fa-sync-alt"></i> Refresh Live Data
                </button>
            </div>
        </div>
        
        <!-- Flood Visualization Map Tab -->
        <div id="map" class="tab-content">
            <h2 class="section-title"><i class="fas fa-map"></i> Interactive Flood Visualization</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-map-marked-alt"></i> Real-time Flood Impact Map</h4>
                <p>Interactive visualization showing current flood risks across the GBM basin. Data sources: Satellite imagery (Sentinel-1), river gauge stations, rainfall radar, and building footprint data from OpenStreetMap/Microsoft. All data is simulated for this research prototype.</p>
            </div>
            
            <!-- Map with controls and legend on the side -->
            <div class="map-with-controls">
                <div class="map-main">
                    <div id="floodMap" class="map-container"></div>
                </div>
                
                <div class="map-sidebar">
                    <!-- Map Controls -->
                    <div class="map-controls-sidebar">
                        <h4><i class="fas fa-sliders-h"></i> Map Controls</h4>
                        <button class="map-control-btn active" id="toggleFlood">
                            <i class="fas fa-water"></i> Flood Extent
                        </button>
                        <button class="map-control-btn" id="toggleBuildings">
                            <i class="fas fa-building"></i> Building Density
                        </button>
                        <button class="map-control-btn" id="toggleDepth">
                            <i class="fas fa-ruler-vertical"></i> Water Depth
                        </button>
                        <button class="map-control-btn" id="toggleInfrastructure">
                            <i class="fas fa-hospital"></i> Critical Infrastructure
                        </button>
                        <button class="map-control-btn" id="toggleFlow">
                            <i class="fas fa-arrow-right"></i> Water Flow
                        </button>
                    </div>
                    
                    <!-- Map Legend -->
                    <div class="map-legend-sidebar">
                        <h4><i class="fas fa-key"></i> Map Legend</h4>
                        <div class="legend-item">
                            <div class="legend-color flood-risk-high"></div>
                            <span>High Flood Risk (2-3m depth)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color flood-risk-medium"></div>
                            <span>Medium Risk (1-2m depth)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color flood-risk-low"></div>
                            <span>Low Risk (0-1m depth)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color building-exposure"></div>
                            <span>Building Density</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color flood-extent"></div>
                            <span>Current Flood Extent</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flood-depth-visualization">
                <h4><i class="fas fa-search-location"></i> Geocoded Location Analysis</h4>
                <div class="geocode-result">
                    <div class="input-group" style="display: flex; margin-bottom: 10px;">
                        <input type="text" id="geocodeInput" placeholder="Enter location (e.g., Kurigram, Bangladesh)" style="flex: 1; padding: 10px; border: 1px solid #dee2e6; border-radius: 4px;">
                        <button class="btn btn-primary" id="geocodeButton" style="margin-left: 10px; padding: 10px 20px;">
                            <i class="fas fa-search"></i> Analyze
                        </button>
                    </div>
                    <div id="geocodeResult">
                        <p>Enter a location to analyze flood risk, building exposure, and vulnerability metrics.</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-exclamation-circle"></i> High Risk Areas Analysis</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Predicted Depth</th>
                                <th>Buildings at Risk</th>
                                <th>Time to Flood</th>
                            </tr>
                        </thead>
                        <tbody id="highRiskTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-clock"></i> Timeline Predictions</h3>
                    <div class="chart-container">
                        <canvas id="timelineChart"></canvas>
                    </div>
                    <p>Predicted flood progression over the next 7 days based on current meteorological data.</p>
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="updateMap">
                    <i class="fas fa-sync-alt"></i> Update with Latest Satellite Data
                </button>
                <button class="btn btn-success" id="exportMap">
                    <i class="fas fa-download"></i> Export Map for Emergency Teams
                </button>
                <button class="btn btn-warning" id="simulateRainfall">
                    <i class="fas fa-cloud-rain"></i> Simulate Rainfall Scenario
                </button>
            </div>
        </div>
        
        <!-- ANALYTICAL GRAPHS Tab -->
        <div id="analytical-graphs" class="tab-content">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> Analytical Graphs</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-chart-line"></i> Flood Exposure Analytics</h4>
                <p>Detailed analytical graphs showing flood exposure across different administrative units, population impact, and infrastructure vulnerability. All data is simulated for research demonstration.</p>
                
                <div class="chart-tips">
                    <div class="chart-tip">
                        <i class="fas fa-chart-bar"></i>
                        <strong>Bar Charts</strong><br>
                        Compare different regions
                    </div>
                    <div class="chart-tip">
                        <i class="fas fa-chart-pie"></i>
                        <strong>Pie Charts</strong><br>
                        Show percentages
                    </div>
                    <div class="chart-tip">
                        <i class="fas fa-chart-line"></i>
                        <strong>Line Charts</strong><br>
                        Track changes over time
                    </div>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3 class="card-title"><i class="fas fa-map-marked-alt"></i> Flood Exposure by State <span class="tooltip-explanation">(ADM1)
                        <span class="tooltiptext">ADM1 = State/Province level analysis. Shows flood risk across major administrative regions.</span>
                    </span></h3>
                    <div class="chart-container">
                        <canvas id="stateExposureChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>What this shows:</strong> Percentage of each state/province that is at flood risk. Higher percentages mean more of that state will be affected.</p>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="card-title"><i class="fas fa-chart-pie"></i> District-wise Population Affected <span class="tooltip-explanation">(ADM2)
                        <span class="tooltiptext">ADM2 = District/County level analysis. Shows which specific districts have the most people at risk.</span>
                    </span></h3>
                    <div class="chart-container">
                        <canvas id="districtPopulationChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>What this shows:</strong> Top 10 districts with the most people at risk. This helps prioritize emergency response resources.</p>
                    </div>
                </div>
            </div>
            
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3 class="card-title"><i class="fas fa-ruler-combined"></i> Population vs Flood Depth Correlation</h3>
                    <div class="chart-container">
                        <canvas id="populationDepthChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>What this shows:</strong> How flood depth relates to affected population. Each dot represents a district. Deeper floods (right side) affect more people.</p>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3 class="card-title"><i class="fas fa-road"></i> Roads Affected Over Time</h3>
                    <div class="chart-container">
                        <canvas id="roadsAffectedChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>What this shows:</strong> How road networks get disrupted as flooding progresses. Local roads (red) are affected first, then highways (blue).</p>
                    </div>
                </div>
            </div>
            
            <div class="analytics-card" style="grid-column: 1 / -1;">
                <h3 class="card-title"><i class="fas fa-chart-area"></i> Flood Impact Stacked Analysis</h3>
                <div class="stacked-chart-container">
                    <canvas id="floodImpactStackedChart"></canvas>
                </div>
                <div class="chart-explanation">
                    <p><strong>What this shows:</strong> Multiple impacts stacked together for each district. Shows total flood impact across different dimensions (people, buildings, roads, agriculture).</p>
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="refreshAnalytics">
                    <i class="fas fa-sync-alt"></i> Refresh Analytics
                </button>
                <button class="btn btn-success" id="exportAnalyticsData">
                    <i class="fas fa-download"></i> Export Analytics Data
                </button>
                <button class="btn btn-secondary" id="generateAnalyticsReport">
                    <i class="fas fa-file-alt"></i> Generate Analytics Report
                </button>
            </div>
        </div>
        
        <!-- Warning System Tab -->
        <div id="warnings" class="tab-content">
            <h2 class="section-title"><i class="fas fa-bullhorn"></i> Multi-tier Warning System</h2>
            
            <div class="alert-box warning" id="warningAlertBox">
                <i class="fas fa-exclamation-triangle"></i>
                <div id="warningAlertText">
                    <!-- Warning text will be updated based on selection -->
                </div>
            </div>
            
            <div class="warning-messages">
                <div class="warning-card warning-basic">
                    <h3 class="warning-title"><i class="fas fa-users"></i> Community Warnings (Simple)</h3>
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 3rem; color: var(--warning-red); margin-bottom: 10px;">
                            âš ï¸ðŸŒŠ
                        </div>
                        <h3 style="color: var(--warning-red); margin-bottom: 15px;" id="simpleWarningTitle">FLOOD ALERT! WATER RISING</h3>
                        <p>Expected in: <strong id="simpleWarningTime">2-3 DAYS</strong></p>
                        <p>Water height: <strong id="simpleWarningHeight">ABOVE WAIST LEVEL</strong></p>
                        <p>Affected: <strong id="simpleWarningAffected">GROUND FLOORS OF HOUSES</strong></p>
                        <div style="background-color: var(--warning-red); color: white; padding: 15px; border-radius: 8px; margin: 20px 0; font-weight: bold;">
                            <i class="fas fa-running"></i> MOVE TO HIGHER GROUND!
                        </div>
                        <p><i class="fas fa-box"></i> Take: Food, documents, medicines</p>
                        <p><i class="fas fa-home"></i> Move to upper floors or evacuation centers</p>
                        <p><i class="fas fa-phone"></i> Emergency: 999</p>
                    </div>
                    <div class="simulation-controls" style="margin-top: 20px;">
                        <button class="btn btn-warning" style="width: 100%;" id="sendSMS">
                            <i class="fas fa-sms"></i> Send SMS Alerts
                        </button>
                    </div>
                </div>
                
                <div class="warning-card warning-impact">
                    <h3 class="warning-title"><i class="fas fa-user-shield"></i> Emergency Responder Briefing</h3>
                    <p><strong id="responderBriefingTitle">Flood Impact Forecast - Selected Region</strong></p>
                    <div class="data-point">
                        <span class="data-label">Expected Flood Depth</span>
                        <span class="data-value" id="responderDepth">2.1-2.4 meters</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Affected Population</span>
                        <span class="data-value" id="responderPopulation">~425,000 people</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Buildings at Risk</span>
                        <span class="data-value" id="responderBuildings">85,200 buildings</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Critical Infrastructure</span>
                        <span class="data-value" id="responderInfrastructure">12 schools, 4 health clinics, 2 bridges</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Evacuation Centers Ready</span>
                        <span class="data-value" id="responderShelters">42 centers (Capacity: 84,000)</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Priority Actions</span>
                        <span class="data-value" id="responderActions">Evacuate chars, secure utilities, preposition supplies</span>
                    </div>
                    <div class="simulation-controls" style="margin-top: 20px;">
                        <button class="btn btn-primary" style="width: 100%;" id="generateResponsePlan">
                            <i class="fas fa-clipboard-list"></i> Generate Response Plan
                        </button>
                    </div>
                </div>
                
                <div class="warning-card warning-financial">
                    <h3 class="warning-title"><i class="fas fa-chart-line"></i> Government & Planner Briefing</h3>
                    <p><strong id="economicImpactTitle">Economic Impact Assessment - Selected Region</strong></p>
                    <div class="data-point">
                        <span class="data-label">Estimated Property Damage</span>
                        <span class="data-value" id="economicProperty">$125-175 million</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Agricultural Losses</span>
                        <span class="data-value" id="economicAgriculture">$45-65 million</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Infrastructure Damage</span>
                        <span class="data-value" id="economicInfrastructure">$30-50 million</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Building Repair Costs</span>
                        <span class="data-value" id="economicBuildings">$85-120 million</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Total Economic Impact</span>
                        <span class="data-value" style="color: var(--warning-red); font-size: 1.2rem;" id="economicTotal">$200-290 million</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Recommended Actions</span>
                        <span class="data-value" id="economicActions">Activate emergency funds, insurance mechanisms</span>
                    </div>
                    <div class="simulation-controls" style="margin-top: 20px;">
                        <button class="btn btn-success" style="width: 100%;" id="generateEconomicReport">
                            <i class="fas fa-file-invoice-dollar"></i> Economic Impact Report
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="ai-report">
                <h3 class="ai-report-title"><i class="fas fa-robot"></i> AI-Generated Warning Strategy</h3>
                <div class="ai-report-content" id="warningStrategyContent">
                    <!-- Warning strategy content will be updated -->
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-warning" id="sendWarnings">
                    <i class="fas fa-paper-plane"></i> Activate Full Warning System
                </button>
                <button class="btn btn-primary" id="createCustomWarning">
                    <i class="fas fa-edit"></i> Create Custom Warning Message
                </button>
                <button class="btn btn-secondary" id="viewWarningHistory">
                    <i class="fas fa-history"></i> View Warning History & Analytics
                </button>
            </div>
        </div>
        
        <!-- Building Exposure Tab -->
        <div id="buildings" class="tab-content">
            <h2 class="section-title"><i class="fas fa-building"></i> Building Exposure Analysis</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-home"></i> Building Vulnerability Assessment Methodology</h4>
                <p>This analysis combines OpenStreetMap building footprints, Microsoft Building Footprints, and local government data to assess building vulnerability. Each building is analyzed for flood exposure based on predicted water depth, construction type, and elevation. Results inform evacuation priorities and damage estimates.</p>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="buildingTotal">85,200</div>
                    <div class="metric-label">Buildings in Flood Zone</div>
                    <div class="decline"><i class="fas fa-exclamation-triangle"></i> 18% of regional total</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="buildingResidential">72,420</div>
                    <div class="metric-label">Residential Buildings</div>
                    <div><i class="fas fa-home"></i> 85% of affected</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="buildingDamage">$125-175M</div>
                    <div class="metric-label">Estimated Building Damage</div>
                    <div class="decline"><i class="fas fa-dollar-sign"></i> Residential: $95-135M</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="buildingCritical">42</div>
                    <div class="metric-label">Critical Facilities at Risk</div>
                    <div class="decline"><i class="fas fa-hospital"></i> Schools, clinics, bridges</div>
                </div>
            </div>
            
            <div class="building-visualization">
                <div class="visualization-card">
                    <h3 class="visualization-title"><i class="fas fa-chart-pie"></i> Building Type Distribution</h3>
                    <div class="chart-container">
                        <canvas id="buildingTypeChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>What this shows:</strong> Different types of buildings in the flood zone. Residential buildings (homes) make up the majority of flood-affected buildings.</p>
                    </div>
                </div>
                
                <div class="visualization-card">
                    <h3 class="visualization-title"><i class="fas fa-chart-bar"></i> Damage by Building Type</h3>
                    <div class="chart-container">
                        <canvas id="buildingDamageChart"></canvas>
                    </div>
                    <div class="chart-explanation">
                        <p><strong>What this shows:</strong> Estimated repair costs for different building types. Industrial buildings cost most to repair, but residential buildings have the highest total cost.</p>
                    </div>
                </div>
            </div>
            
            <div class="building-type-breakdown" id="buildingBreakdown">
                <!-- Building breakdown will be populated by JavaScript -->
            </div>
            
            <div class="ai-report">
                <h3 class="ai-report-title"><i class="fas fa-clipboard-check"></i> Building Exposure Analysis Report</h3>
                <div class="report-container" id="buildingReportContent">
                    <!-- Building report will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="analyzeBuildings">
                    <i class="fas fa-search"></i> Run Building Exposure Analysis
                </button>
                <button class="btn btn-success" id="exportBuildingData">
                    <i class="fas fa-download"></i> Export Building Data (GeoJSON)
                </button>
                <button class="btn btn-warning" id="prioritizeEvacuation">
                    <i class="fas fa-people-arrows"></i> Generate Evacuation Priority List
                </button>
            </div>
        </div>
        
        <!-- Federated Learning Tab -->
        <div id="fl" class="tab-content">
            <h2 class="section-title"><i class="fas fa-brain"></i> Federated Learning System</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-user-secret"></i> Privacy-Preserving AI Training</h4>
                <p>Instead of sharing sensitive water data between countries, each country trains the AI model locally on their own secure servers. Only the improved model parameters (not the raw data) are shared. This preserves data sovereignty while creating accurate basin-wide flood predictions. Differential privacy adds noise to protect individual data points.</p>
                
                <div class="chart-tips">
                    <div class="chart-tip">
                        <i class="fas fa-server"></i>
                        <strong>Local Training</strong><br>
                        Data stays in each country
                    </div>
                    <div class="chart-tip">
                        <i class="fas fa-exchange-alt"></i>
                        <strong>Model Sharing</strong><br>
                        Only AI knowledge shared
                    </div>
                    <div class="chart-tip">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Privacy Protected</strong><br>
                        Îµ=1.2 differential privacy
                    </div>
                </div>
            </div>
            
            <div class="fl-data-nodes">
                <div class="fl-node" id="node-nepal">
                    <div class="fl-node-icon">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <h3>Nepal Node</h3>
                    <p>Upland data: Snowmelt, mountain rainfall</p>
                    <div class="status-indicator status-active"></div> <span>Active & Secure</span>
                    <div class="data-point">
                        <span class="data-label">Data Protected</span>
                        <span class="data-value" style="color: #28a745;">100%</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Local Training Accuracy</span>
                        <span class="data-value">88.5%</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Model Contribution</span>
                        <span class="data-value">Snowmelt patterns</span>
                    </div>
                </div>
                
                <div class="fl-node active" id="node-india">
                    <div class="fl-node-icon">
                        <i class="fas fa-landmark"></i>
                    </div>
                    <h3>India Node</h3>
                    <p>Midstream data: River flows, reservoir data</p>
                    <div class="status-indicator status-training"></div> <span>Training Round #143</span>
                    <div class="data-point">
                        <span class="data-label">Data Protected</span>
                        <span class="data-value" style="color: #28a745;">100%</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Local Training Accuracy</span>
                        <span class="data-value">90.8%</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Model Contribution</span>
                        <span class="data-value">River flow predictions</span>
                    </div>
                </div>
                
                <div class="fl-node" id="node-bangladesh">
                    <div class="fl-node-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <h3>Bangladesh Node</h3>
                    <p>Downstream data: Flood impacts, damage reports</p>
                    <div class="status-indicator status-active"></div> <span>Active & Secure</span>
                    <div class="data-point">
                        <span class="data-label">Data Protected</span>
                        <span class="data-value" style="color: #28a745;">100%</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Local Training Accuracy</span>
                        <span class="data-value">92.1%</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Model Contribution</span>
                        <span class="data-value">Flood impact accuracy</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="flPerformanceChart"></canvas>
            </div>
            
            <div class="chart-explanation">
                <p><strong>What this chart shows:</strong> Comparison of different AI training approaches. Federated learning (blue) achieves almost the same accuracy as centralized training (gray) but without sharing any raw data between countries. Country-only models (red) perform worse because they don't benefit from basin-wide data.</p>
            </div>
            
            <div class="ai-report">
                <h3 class="ai-report-title"><i class="fas fa-robot"></i> Federated Learning Technical Report</h3>
                <div class="report-container" id="flReportContent">
                    <!-- FL report will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="trainModel">
                    <i class="fas fa-cogs"></i> Start Federated Learning Round
                </button>
                <button class="btn btn-success" id="viewModelDetails">
                    <i class="fas fa-chart-bar"></i> View Model Performance
                </button>
                <button class="btn btn-secondary" id="privacyAudit">
                    <i class="fas fa-user-shield"></i> Run Privacy Audit
                </button>
            </div>
        </div>
        
        <!-- EVACUATION PLANNING Tab -->
        <div id="evacuation" class="tab-content">
            <h2 class="section-title"><i class="fas fa-people-carry"></i> Evacuation Planning Module</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-route"></i> AI-Powered Evacuation Strategy</h4>
                <p>This module integrates flood predictions, population data, road networks, and shelter locations to generate optimal evacuation plans. The system prioritizes vulnerable communities and ensures equitable access to safe shelters.</p>
            </div>
            
            <div class="alert-box warning" id="evacuationAlertBox">
                <!-- Evacuation alert will be updated -->
            </div>
            
            <!-- A. Evacuation Logic -->
            <div class="card">
                <h3 class="card-title"><i class="fas fa-brain"></i> A. Evacuation Logic (Explainable AI)</h3>
                <p><strong>Priority Ranking Algorithm:</strong></p>
                <div class="evacuation-metrics" id="evacuationMetrics">
                    <!-- Evacuation metrics will be populated -->
                </div>
                
                <div style="margin-top: 20px;">
                    <p><strong>Decision Factors:</strong></p>
                    <ul id="evacuationFactors">
                        <!-- Evacuation factors will be populated -->
                    </ul>
                </div>
            </div>
            
            <!-- B. Flowcharts -->
            <div class="flowchart-container">
                <h3 class="card-title"><i class="fas fa-project-diagram"></i> B. Evacuation Decision Flowchart</h3>
                <div class="flowchart" id="evacuationFlowchart">
                    <!-- Flowchart will be populated -->
                </div>
            </div>
            
            <!-- C. Evacuation Plan Output -->
            <div class="evacuation-output">
                <h3 class="card-title"><i class="fas fa-clipboard-list"></i> C. Evacuation Plan Output</h3>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h4><i class="fas fa-map-pin"></i> ADM2-wise Evacuation Plan</h4>
                        <table class="data-table" id="evacuationPlanTable">
                            <!-- Evacuation plan table will be populated -->
                        </table>
                    </div>
                    
                    <div class="card">
                        <h4><i class="fas fa-home"></i> Shelter Capacity vs Population</h4>
                        <div class="chart-container">
                            <canvas id="shelterCapacityChart"></canvas>
                        </div>
                        <div class="chart-explanation">
                            <p><strong>What this shows:</strong> Comparison of available shelter space (green) vs required capacity (red). The gap (orange) shows additional shelters needed.</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h4><i class="fas fa-bus"></i> Transport Requirements</h4>
                    <div class="evacuation-metrics" id="transportRequirements">
                        <!-- Transport requirements will be populated -->
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h4><i class="fas fa-clock"></i> Time-based Evacuation Windows</h4>
                    <table class="data-table" id="evacuationTimelineTable">
                        <!-- Evacuation timeline will be populated -->
                    </table>
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="generateEvacuationPlan">
                    <i class="fas fa-map-marked-alt"></i> Generate Evacuation Plan
                </button>
                <button class="btn btn-success" id="simulateEvacuation">
                    <i class="fas fa-person-running"></i> Simulate Evacuation
                </button>
                <button class="btn btn-warning" id="exportEvacuationPlan">
                    <i class="fas fa-download"></i> Export Plan (PDF)
                </button>
            </div>
        </div>
        
        <!-- Fairness Analytics Tab -->
        <div id="fairness" class="tab-content">
            <h2 class="section-title"><i class="fas fa-balance-scale"></i> Fairness & Equity Analytics</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-heart"></i> Ensuring Equitable Warning Distribution</h4>
                <p>This system continuously monitors whether warnings reach all communities equally, especially vulnerable groups. We track warning lead times, message comprehension, and action rates across different demographics. When disparities are detected, the system automatically adjusts warning strategies to improve equity.</p>
            </div>
            
            <div class="chart-container">
                <canvas id="fairnessChart"></canvas>
            </div>
            
            <div class="chart-explanation">
                <p><strong>What this chart shows:</strong> Comparison of warning system performance for general population (green) vs vulnerable communities (red). Each spoke represents a different metric. Ideally, both groups should have similar performance across all metrics.</p>
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-users"></i> Vulnerable Groups Monitored</h3>
                    <div id="vulnerableGroups">
                        <!-- Vulnerable groups will be populated -->
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-chart-line"></i> Equity Performance Metrics</h3>
                    <div id="equityMetrics">
                        <!-- Equity metrics will be populated -->
                    </div>
                </div>
            </div>
            
            <div class="ai-report">
                <h3 class="ai-report-title"><i class="fas fa-clipboard-check"></i> Equity Audit Report</h3>
                <div class="report-container" id="equityReportContent">
                    <!-- Equity report will be populated -->
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="runFairnessCheck">
                    <i class="fas fa-search"></i> Run Equity Audit Now
                </button>
                <button class="btn btn-success" id="applyFairnessFix">
                    <i class="fas fa-magic"></i> Apply Equity Improvements
                </button>
                <button class="btn btn-warning" id="generateEquityReport">
                    <i class="fas fa-file-alt"></i> Generate Equity Report
                </button>
            </div>
        </div>
        
        <!-- AI Reports Tab -->
        <div id="reports" class="tab-content">
            <h2 class="section-title"><i class="fas fa-file-alt"></i> AI-Generated Analysis Reports</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-robot"></i> Automated Intelligence Reporting</h4>
                <p>The system automatically generates detailed reports for different stakeholders - from community warnings to technical briefings for disaster management agencies. Reports are tailored to audience needs and updated in real-time as new data arrives.</p>
            </div>
            
            <div class="report-container" id="aiReportContainer" style="max-height: 600px;">
                <!-- AI report content will be populated -->
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="generateNewReport">
                    <i class="fas fa-plus-circle"></i> Generate New Custom Report
                </button>
                <button class="btn btn-success" id="downloadReports">
                    <i class="fas fa-download"></i> Download All Reports (PDF)
                </button>
                <button class="btn btn-secondary" id="scheduleReports">
                    <i class="fas fa-calendar-alt"></i> Schedule Automatic Reports
                </button>
            </div>
        </div>
        
        <!-- Data Sources Tab -->
        <div id="data" class="tab-content">
            <h2 class="section-title"><i class="fas fa-database"></i> Data Sources & Integration</h2>
            
            <div class="simple-explanation">
                <h4><i class="fas fa-satellite"></i> Multi-source Data Integration</h4>
                <p>This system integrates data from multiple sources while preserving privacy through federated learning. Each country maintains sovereignty over their data while contributing to basin-wide flood predictions.</p>
            </div>
            
            <div class="dashboard-grid">
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-satellite-dish"></i> Satellite & Remote Sensing</h3>
                    <div id="satelliteData">
                        <!-- Satellite data will be populated -->
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-water"></i> In-situ Measurements</h3>
                    <div id="insituData">
                        <!-- In-situ data will be populated -->
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-building"></i> Building & Infrastructure Data</h3>
                    <div id="buildingData">
                        <!-- Building data will be populated -->
                    </div>
                </div>
            </div>
            
            <div class="ai-report">
                <h3 class="ai-report-title"><i class="fas fa-project-diagram"></i> Data Integration Architecture</h3>
                <div class="report-container" id="dataIntegrationReport">
                    <!-- Data integration report will be populated -->
                </div>
            </div>
            
            <div class="simulation-controls">
                <button class="btn btn-primary" id="checkDataQuality">
                    <i class="fas fa-check-circle"></i> Run Data Quality Check
                </button>
                <button class="btn btn-success" id="updateDataSources">
                    <i class="fas fa-sync-alt"></i> Update All Data Sources
                </button>
                <button class="btn btn-secondary" id="dataPrivacyAudit">
                    <i class="fas fa-shield-alt"></i> Run Privacy Audit
                </button>
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 20px;">
                <h2 style="margin: 0; color: var(--primary-blue);">AI-Generated Detailed Report</h2>
                <span id="closeModal" style="font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa;">&times;</span>
            </div>
            <div id="modalReportContent" style="margin-bottom: 20px;">
                <!-- Report content will be inserted here -->
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #ddd; padding-top: 20px;">
                <button id="closeReportBtn" class="btn btn-secondary">Close</button>
                <button id="downloadReportBtn" class="btn btn-primary">Download PDF Report</button>
            </div>
        </div>
    </div>
    
    <div class="floating-ai-assistant" id="aiAssistant">
        <i class="fas fa-robot"></i>
    </div>
    
    <div class="ai-chat-box" id="aiChat">
        <div class="ai-chat-header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-robot"></i>
                <span>Flood Forecasting AI Assistant</span>
            </div>
            <i class="fas fa-times" id="closeChat" style="cursor: pointer;"></i>
        </div>
        <div class="ai-chat-body" id="chatBody">
            <div class="ai-message">
                Hello! I'm your flood forecasting AI assistant. I can help you understand flood risks, check system status, or explain how federated learning works. How can I help you today?
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="chatInput" placeholder="Ask me about flood forecasts..." />
            <button class="btn btn-primary" id="sendChat" style="padding: 10px 15px;">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <footer class="container">
        <p>This is a demonstration prototype for the DPhil Research Proposal: "Federated and Fair Flood Forecasting: Privacy-Preserving and Behaviourally Grounded Early Warning Systems for the GBM Basin"</p>
        <p>Submitted By: Aleema Ahmad Samir | Proposed Supervisor: Dr. Avidesh Seenath | University of Oxford</p>
        <p><strong>Research Note:</strong> All data shown is simulated for demonstration purposes. No real flood warnings are being issued. This prototype demonstrates how federated learning can enable transboundary flood forecasting while preserving data sovereignty.</p>
    </footer>

    <script>
        // Global variables
        let map, flPerformanceChart, fairnessChart, buildingDamageChart, buildingTypeChart, riskTimelineChart, timelineChart;
        let chatMessages = [];
        let buildingLayer, floodExtentLayer, depthLayer, infrastructureLayer, flowLayer;
        let showBuildings = false, showFlood = true, showDepth = false, showInfrastructure = false, showFlow = false;
        let liveDataInterval;
        let lastUpdateTime = new Date();
        
        // Region selection variables
        let currentSubBasin = 'ganga';
        let currentCountry = 'india';
        let currentSelection = 'ganga_india';
        
        // ANALYTICAL GRAPHS Variables
        let stateExposureChart, districtPopulationChart, populationDepthChart, roadsAffectedChart, floodImpactStackedChart, shelterCapacityChart;
        
        // Global object for analytical charts
        let analyticalCharts = {};
        
        // Track initialized tabs per tab
        let initializedTabs = {
            dashboard: false,
            map: false,
            analyticalGraphs: false,
            buildings: false,
            fl: false,
            evacuation: false,
            fairness: false
        };
        
        // Region-specific data
        const regionData = {
            'ganga_india': {
                name: 'Ganga Basin, India',
                center: [25.0, 83.0],
                zoom: 6,
                accuracy: 92.5,
                leadTime: 38.2,
                buildingsAtRisk: 125000,
                activeWarnings: 4,
                peopleAtRisk: 625000,
                maxDepth: 2.1,
                flRounds: 128,
                fairnessScore: 82,
                warningTimeDiff: -1.8,
                missedWarningRate: 3.8,
                comprehensionGap: -15,
                evacuationRateDiff: -10,
                damageAccuracyDiff: -0.12
            },
            'ganga_nepal': {
                name: 'Ganga Basin, Nepal',
                center: [28.0, 84.0],
                zoom: 7,
                accuracy: 88.5,
                leadTime: 32.5,
                buildingsAtRisk: 45000,
                activeWarnings: 2,
                peopleAtRisk: 225000,
                maxDepth: 1.8,
                flRounds: 95,
                fairnessScore: 78,
                warningTimeDiff: -3.2,
                missedWarningRate: 5.2,
                comprehensionGap: -22,
                evacuationRateDiff: -15,
                damageAccuracyDiff: -0.18
            },
            'ganga_bangladesh': {
                name: 'Ganga Basin, Bangladesh',
                center: [23.5, 89.0],
                zoom: 7,
                accuracy: 91.2,
                leadTime: 36.8,
                buildingsAtRisk: 85000,
                activeWarnings: 3,
                peopleAtRisk: 425000,
                maxDepth: 2.4,
                flRounds: 142,
                fairnessScore: 84,
                warningTimeDiff: -2.1,
                missedWarningRate: 4.3,
                comprehensionGap: -18,
                evacuationRateDiff: -12,
                damageAccuracyDiff: -0.15
            },
            'brahmaputra_india': {
                name: 'Brahmaputra Basin, India',
                center: [26.5, 92.5],
                zoom: 7,
                accuracy: 90.8,
                leadTime: 35.5,
                buildingsAtRisk: 95000,
                activeWarnings: 3,
                peopleAtRisk: 475000,
                maxDepth: 2.8,
                flRounds: 135,
                fairnessScore: 79,
                warningTimeDiff: -2.5,
                missedWarningRate: 4.8,
                comprehensionGap: -20,
                evacuationRateDiff: -14,
                damageAccuracyDiff: -0.20
            },
            'brahmaputra_bangladesh': {
                name: 'Brahmaputra Basin, Bangladesh',
                center: [25.5, 90.0],
                zoom: 7,
                accuracy: 93.1,
                leadTime: 40.2,
                buildingsAtRisk: 110000,
                activeWarnings: 4,
                peopleAtRisk: 550000,
                maxDepth: 3.2,
                flRounds: 155,
                fairnessScore: 81,
                warningTimeDiff: -2.8,
                missedWarningRate: 5.1,
                comprehensionGap: -25,
                evacuationRateDiff: -18,
                damageAccuracyDiff: -0.22
            },
            'meghna_bangladesh': {
                name: 'Meghna Basin, Bangladesh',
                center: [24.0, 91.0],
                zoom: 7,
                accuracy: 94.2,
                leadTime: 42.5,
                buildingsAtRisk: 125000,
                activeWarnings: 5,
                peopleAtRisk: 625000,
                maxDepth: 3.5,
                flRounds: 165,
                fairnessScore: 83,
                warningTimeDiff: -3.1,
                missedWarningRate: 5.5,
                comprehensionGap: -28,
                evacuationRateDiff: -20,
                damageAccuracyDiff: -0.25
            }
        };
        
        // Dummy data for simulation
        let dummyData = { ...regionData['ganga_india'] };
        
        // Initialize the application
        function initApplication() {
            setupTabSwitching();
            initializeCharts();
            setupEventHandlers();
            startLiveDataSimulation();
            setupAIAssistant();
            updateLastUpdateTime();
            setupReportModal();
            enhanceEventHandlers();
            setupRegionSelection();
            setupDepthSlider();
            
            // Initialize dashboard charts
            if (document.getElementById('dashboard').classList.contains('active')) {
                setTimeout(initializeDashboardCharts, 100);
            }
            
            // Update display with current selection
            updateCurrentSelectionDisplay();
            
            // Initialize building breakdown
            updateBuildingBreakdown();
            
            // Initialize evacuation content
            initializeEvacuationContent();
            
            // Initialize fairness content
            initializeFairnessContent();
            
            // Initialize AI reports
            initializeAIReports();
            
            // Initialize data sources
            initializeDataSources();
            
            // Start flood flow animation
            startFloodFlowAnimation();
        }
        
        // Start flood flow animation
        function startFloodFlowAnimation() {
            // This animation runs continuously to show water flow
            setInterval(() => {
                const arrow = document.querySelector('.flow-arrow');
                if (arrow) {
                    // Reset animation
                    arrow.style.animation = 'none';
                    setTimeout(() => {
                        arrow.style.animation = 'moveArrow 3s infinite linear';
                    }, 10);
                }
            }, 3000);
        }
        
        // Setup region selection
        function setupRegionSelection() {
            const subBasinSelect = document.getElementById('subBasinSelect');
            const countrySelect = document.getElementById('countrySelect');
            const applyFilterBtn = document.getElementById('applyRegionFilter');
            
            if (subBasinSelect && countrySelect && applyFilterBtn) {
                // Set initial values
                subBasinSelect.value = currentSubBasin;
                countrySelect.value = currentCountry;
                
                // Add event listeners
                applyFilterBtn.addEventListener('click', applyRegionFilter);
                
                // Also apply filter when selection changes
                subBasinSelect.addEventListener('change', function() {
                    currentSubBasin = this.value;
                    updateCurrentSelectionDisplay();
                });
                
                countrySelect.addEventListener('change', function() {
                    currentCountry = this.value;
                    updateCurrentSelectionDisplay();
                });
            }
        }
        
        function setupDepthSlider() {
            const depthSlider = document.getElementById('depthSlider');
            const depthValue = document.getElementById('depthValue');
            const floodDepthVisual = document.getElementById('floodDepthVisual');
            const floodDepthLabel = document.getElementById('floodDepthLabel');
            
            if (depthSlider && depthValue && floodDepthVisual && floodDepthLabel) {
                depthSlider.addEventListener('input', function() {
                    const depth = (this.value / 10).toFixed(1);
                    depthValue.textContent = depth + ' meters';
                    
                    // Update visual indicator
                    const visualHeight = Math.min(95, 20 + (depth * 25));
                    floodDepthVisual.style.height = visualHeight + '%';
                    
                    // Update label
                    let labelText = "Current: " + depth + "m";
                    if (depth < 0.5) labelText += " (Safe)";
                    else if (depth < 1.0) labelText += " (Ankle level)";
                    else if (depth < 1.5) labelText += " (Knee level)";
                    else if (depth < 2.0) labelText += " (Waist level)";
                    else if (depth < 2.5) labelText += " (Chest level)";
                    else labelText += " (Overhead)";
                    floodDepthLabel.textContent = labelText;
                    
                    // Update charts if they exist
                    updateChartsForDepth(depth);
                });
            }
        }
        
        function updateChartsForDepth(depth) {
            // Update population depth chart if it exists
            if (analyticalCharts.populationDepthChart) {
                const newData = [];
                for (let i = 0; i < 7; i++) {
                    const floodDepth = 0.5 + i * 0.3;
                    const population = Math.floor(dummyData.peopleAtRisk * (0.1 + Math.random() * 0.2));
                    newData.push({x: floodDepth, y: population/1000});
                }
                analyticalCharts.populationDepthChart.data.datasets[0].data = newData;
                analyticalCharts.populationDepthChart.update();
            }
        }
        
        function updateCurrentSelectionDisplay() {
            const displayText = document.getElementById('currentSelectionText');
            const subBasinSelect = document.getElementById('subBasinSelect');
            const countrySelect = document.getElementById('countrySelect');
            
            if (displayText && subBasinSelect && countrySelect) {
                const subBasinText = subBasinSelect.options[subBasinSelect.selectedIndex].text;
                const countryText = countrySelect.options[countrySelect.selectedIndex].text;
                displayText.textContent = `${subBasinText}, ${countryText}`;
            }
        }
        
        function applyRegionFilter() {
            const subBasinSelect = document.getElementById('subBasinSelect');
            const countrySelect = document.getElementById('countrySelect');
            
            currentSubBasin = subBasinSelect.value;
            currentCountry = countrySelect.value;
            currentSelection = `${currentSubBasin}_${currentCountry}`;
            
            // Update dummy data based on selection
            if (regionData[currentSelection]) {
                dummyData = { ...regionData[currentSelection] };
            } else {
                // Default to first combination
                dummyData = { ...regionData['ganga_india'] };
                currentSelection = 'ganga_india';
            }
            
            updateCurrentSelectionDisplay();
            updateDashboardMetrics();
            
            // Update map if it exists
            if (map) {
                updateMapForRegion();
            }
            
            // Update charts if they exist
            updateChartsForRegion();
            
            // Update all tab content
            updateAllTabContent();
            
            showNotification(
                'ðŸŒ Region Filter Applied',
                `Now showing data for: ${dummyData.name}`,
                'success'
            );
        }
        
        function updateMapForRegion() {
            if (!map) return;
            
            // Remove existing layers
            if (buildingLayer) map.removeLayer(buildingLayer);
            if (floodExtentLayer) map.removeLayer(floodExtentLayer);
            if (depthLayer) map.removeLayer(depthLayer);
            if (infrastructureLayer) map.removeLayer(infrastructureLayer);
            if (flowLayer) map.removeLayer(flowLayer);
            
            // Set view based on region
            map.setView(dummyData.center, dummyData.zoom);
            
            // Create new layers based on region
            createRegionSpecificLayers();
            
            // Update map controls
            setupMapControls();
        }
        
        function createRegionSpecificLayers() {
            // Create flood extent layer based on region
            const floodCoords = getFloodCoordinatesForRegion();
            floodExtentLayer = L.polygon(floodCoords, {
                color: '#0066ff',
                fillColor: '#0066ff',
                fillOpacity: 0.3,
                weight: 2
            }).addTo(map).bindPopup(`<b>Current Flood Extent</b><br>Predicted flood area in ${dummyData.name}<br>${dummyData.buildingsAtRisk.toLocaleString()} buildings affected<br>Flood depth: ${(dummyData.maxDepth - 0.3).toFixed(1)}-${dummyData.maxDepth.toFixed(1)}m`);
            
            // Create water flow layer
            createWaterFlowLayer();
            
            // Create building density layer
            createBuildingLayer();
            
            // Create infrastructure layer
            createInfrastructureLayer();
        }
        
        function createWaterFlowLayer() {
            flowLayer = L.layerGroup();
            
            // Create arrow markers to show water flow direction
            const center = dummyData.center;
            const numArrows = 5;
            
            for (let i = 0; i < numArrows; i++) {
                const lat = center[0] + (Math.random() * 0.5 - 0.25);
                const lng = center[1] + (Math.random() * 0.5 - 0.25);
                
                const arrowIcon = L.divIcon({
                    className: 'water-flow-arrow',
                    html: '<div style="transform: rotate(45deg); color: #0066ff; font-size: 20px;">âž¤</div>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
                
                L.marker([lat, lng], { icon: arrowIcon })
                    .addTo(flowLayer)
                    .bindPopup(`<b>Water Flow Direction</b><br>Flow velocity: ${(0.5 + Math.random() * 1.5).toFixed(1)} m/s<br>Direction: Downstream`);
            }
            
            // Create flow lines
            const flowLines = [
                [center[0] + 0.3, center[1] - 0.3],
                [center[0], center[1]],
                [center[0] - 0.3, center[1] + 0.3]
            ];
            
            L.polyline(flowLines, {
                color: '#0066ff',
                weight: 3,
                opacity: 0.6,
                dashArray: '10, 10'
            }).addTo(flowLayer).bindPopup('<b>Main Water Flow Path</b><br>Primary direction of flood water movement');
        }
        
        function getFloodCoordinatesForRegion() {
            // Generate different flood shapes based on region
            const center = dummyData.center;
            const coords = [];
            
            // Create a polygon around the center point
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * 2 * Math.PI;
                const radius = 0.3 + Math.random() * 0.2;
                const lat = center[0] + radius * Math.cos(angle);
                const lng = center[1] + radius * Math.sin(angle);
                coords.push([lat, lng]);
            }
            
            return coords;
        }
        
        function createBuildingLayer() {
            buildingLayer = L.layerGroup();
            const numBuildings = Math.min(200, Math.floor(dummyData.buildingsAtRisk / 500));
            
            for (let i = 0; i < numBuildings; i++) {
                const lat = dummyData.center[0] + (Math.random() * 0.6 - 0.3);
                const lng = dummyData.center[1] + (Math.random() * 0.6 - 0.3);
                
                L.circleMarker([lat, lng], {
                    radius: 3,
                    color: '#5757ed',
                    fillColor: '#5757ed',
                    fillOpacity: 0.6,
                    weight: 1
                }).addTo(buildingLayer);
            }
        }
        
        function createInfrastructureLayer() {
            infrastructureLayer = L.layerGroup();
            const infrastructureTypes = ['hospital', 'school', 'bridge', 'power'];
            
            for (let i = 0; i < 4; i++) {
                const lat = dummyData.center[0] + (Math.random() * 0.4 - 0.2);
                const lng = dummyData.center[1] + (Math.random() * 0.4 - 0.2);
                const type = infrastructureTypes[i];
                
                let iconColor = '#39c0ed';
                if (type === 'hospital') iconColor = '#e63946';
                if (type === 'school') iconColor = '#ff9800';
                if (type === 'bridge') iconColor = '#6c757d';
                
                L.circleMarker([lat, lng], {
                    radius: 8,
                    color: iconColor,
                    fillColor: iconColor,
                    fillOpacity: 0.8,
                    weight: 2
                }).addTo(infrastructureLayer).bindPopup(`<b>${type.charAt(0).toUpperCase() + type.slice(1)} Facility</b><br>Type: ${type}<br>Status: At risk<br>Flood depth: ${(dummyData.maxDepth * 0.8).toFixed(1)}m predicted`);
            }
        }
        
        function updateChartsForRegion() {
            // Update federated learning chart
            if (flPerformanceChart) {
                flPerformanceChart.data.datasets[1].data[3] = dummyData.accuracy;
                flPerformanceChart.update();
            }
            
            // Update fairness chart
            if (fairnessChart) {
                // Adjust fairness data based on region
                const generalPop = Math.max(70, 100 - Math.abs(dummyData.fairnessScore - 85));
                const vulnerablePop = Math.max(60, generalPop - 15);
                
                fairnessChart.data.datasets[0].data = [generalPop - 5, generalPop - 10, generalPop - 12, generalPop - 8, generalPop - 11];
                fairnessChart.data.datasets[1].data = [vulnerablePop, vulnerablePop - 2, vulnerablePop + 1, vulnerablePop - 3, vulnerablePop - 5];
                fairnessChart.update();
            }
            
            // Update analytical graphs if they exist
            updateAnalyticalGraphsForRegion();
            
            // Update building charts if they exist
            updateBuildingChartsForRegion();
            
            // Update evacuation charts if they exist
            updateEvacuationChartsForRegion();
        }
        
        function updateAnalyticalGraphsForRegion() {
            // Update state exposure chart
            if (analyticalCharts.stateExposureChart) {
                const labels = getStateLabelsForRegion();
                const data = getStateExposureDataForRegion();
                
                analyticalCharts.stateExposureChart.data.labels = labels;
                analyticalCharts.stateExposureChart.data.datasets[0].data = data;
                analyticalCharts.stateExposureChart.update();
            }
            
            // Update district population chart - FIXED
            if (analyticalCharts.districtPopulationChart) {
                const labels = getDistrictLabelsForRegion();
                const data = getDistrictPopulationDataForRegion();
                
                analyticalCharts.districtPopulationChart.data.labels = labels;
                analyticalCharts.districtPopulationChart.data.datasets[0].data = data;
                analyticalCharts.districtPopulationChart.update();
            }
            
            // Update population depth chart
            if (analyticalCharts.populationDepthChart) {
                const data = [];
                for (let i = 0; i < 7; i++) {
                    const depth = 0.5 + i * 0.3;
                    const population = Math.floor(dummyData.peopleAtRisk * (0.1 + Math.random() * 0.2));
                    data.push({x: depth, y: population/1000});
                }
                analyticalCharts.populationDepthChart.data.datasets[0].data = data;
                analyticalCharts.populationDepthChart.update();
            }
            
            // Update roads affected chart
            if (analyticalCharts.roadsAffectedChart) {
                // Update chart data based on region
                const baseValue = dummyData.buildingsAtRisk / 100;
                analyticalCharts.roadsAffectedChart.data.datasets[0].data = [0, baseValue*0.1, baseValue*0.3, baseValue*0.5, baseValue*0.7, baseValue*0.85, baseValue*0.95, baseValue*0.98, baseValue];
                analyticalCharts.roadsAffectedChart.update();
            }
            
            // Update flood impact stacked chart
            if (analyticalCharts.floodImpactStackedChart) {
                const labels = getDistrictLabelsForRegion().slice(0, 5);
                analyticalCharts.floodImpactStackedChart.data.labels = labels;
                
                // Update data based on region
                const peopleData = labels.map(() => Math.floor(dummyData.peopleAtRisk * (0.1 + Math.random() * 0.1) / 1000));
                const buildingData = labels.map(() => Math.floor(dummyData.buildingsAtRisk * (0.1 + Math.random() * 0.05) / 1000));
                const roadsData = labels.map(() => Math.floor(dummyData.buildingsAtRisk * (0.5 + Math.random() * 0.3) / 100));
                const agriData = labels.map(() => Math.floor(dummyData.buildingsAtRisk * (50 + Math.random() * 30)));
                
                analyticalCharts.floodImpactStackedChart.data.datasets[0].data = peopleData;
                analyticalCharts.floodImpactStackedChart.data.datasets[1].data = buildingData;
                analyticalCharts.floodImpactStackedChart.data.datasets[2].data = roadsData;
                analyticalCharts.floodImpactStackedChart.data.datasets[3].data = agriData;
                
                analyticalCharts.floodImpactStackedChart.update();
            }
        }
        
        function getStateLabelsForRegion() {
            if (currentCountry === 'india') {
                return ['Uttar Pradesh', 'Bihar', 'West Bengal', 'Uttarakhand', 'Jharkhand', 'Delhi', 'Haryana'];
            } else if (currentCountry === 'bangladesh') {
                return ['Dhaka', 'Chittagong', 'Khulna', 'Rajshahi', 'Barisal', 'Sylhet', 'Rangpur'];
            } else if (currentCountry === 'nepal') {
                return ['Province 1', 'Province 2', 'Bagmati', 'Gandaki', 'Lumbini', 'Karnali', 'Sudurpashchim'];
            }
            return ['Region 1', 'Region 2', 'Region 3', 'Region 4', 'Region 5'];
        }
        
        function getStateExposureDataForRegion() {
            // Generate data based on region
            const baseData = [45, 38, 32, 28, 22, 18, 15];
            return baseData.map(value => Math.min(50, value + (Math.random() * 10 - 5)));
        }
        
        function getDistrictLabelsForRegion() {
            if (currentCountry === 'india' && currentSubBasin === 'ganga') {
                return ['Varanasi', 'Patna', 'Kolkata', 'Allahabad', 'Kanpur', 'Lucknow', 'Haridwar', 'Dehradun', 'Ranchi', 'Dhanbad'];
            } else if (currentCountry === 'bangladesh' && currentSubBasin === 'brahmaputra') {
                return ['Kurigram', 'Gaibandha', 'Jamalpur', 'Sirajganj', 'Bogra', 'Rangpur', 'Nilphamari', 'Lalmonirhat', 'Sunamganj', 'Mymensingh'];
            } else if (currentCountry === 'nepal') {
                return ['Kathmandu', 'Pokhara', 'Biratnagar', 'Janakpur', 'Bharatpur', 'Birgunj', 'Butwal', 'Dharan', 'Dhangadhi', 'Nepalgunj'];
            }
            return ['District 1', 'District 2', 'District 3', 'District 4', 'District 5', 'District 6', 'District 7', 'District 8', 'District 9', 'District 10'];
        }
        
        function getDistrictPopulationDataForRegion() {
            // Generate population data based on region
            const baseValue = dummyData.peopleAtRisk / 10000;
            const data = [];
            for (let i = 0; i < 10; i++) {
                data.push(Math.floor(baseValue * (0.5 + Math.random() * 0.5)));
            }
            return data.sort((a, b) => b - a);
        }
        
        function updateBuildingChartsForRegion() {
            // Update building type chart
            if (buildingTypeChart) {
                const residential = Math.floor(dummyData.buildingsAtRisk * 0.85);
                const commercial = Math.floor(dummyData.buildingsAtRisk * 0.10);
                const industrial = Math.floor(dummyData.buildingsAtRisk * 0.03);
                const publicBuildings = Math.floor(dummyData.buildingsAtRisk * 0.02);
                
                buildingTypeChart.data.datasets[0].data = [residential, commercial, industrial, publicBuildings];
                buildingTypeChart.update();
            }
            
            // Update building damage chart
            if (buildingDamageChart) {
                const damageResidential = dummyData.buildingsAtRisk * 0.85 * 1500;
                const damageCommercial = dummyData.buildingsAtRisk * 0.10 * 2500;
                const damageIndustrial = dummyData.buildingsAtRisk * 0.03 * 5000;
                const damagePublic = dummyData.buildingsAtRisk * 0.02 * 2000;
                
                buildingDamageChart.data.datasets[0].data = [
                    damageResidential / 1000000,
                    damageCommercial / 1000000,
                    damageIndustrial / 1000000,
                    damagePublic / 1000000
                ];
                buildingDamageChart.update();
            }
        }
        
        function updateEvacuationChartsForRegion() {
            // Update shelter capacity chart
            if (shelterCapacityChart) {
                const required = dummyData.peopleAtRisk * 0.8 / 1000;
                const available = dummyData.peopleAtRisk * 0.6 / 1000;
                const gap = required - available;
                
                shelterCapacityChart.data.datasets[0].data = [available, required, gap];
                shelterCapacityChart.update();
            }
        }
        
        function updateAllTabContent() {
            // Update high risk areas table
            updateHighRiskAreasTable();
            
            // Update warning system content
            updateWarningSystemContent();
            
            // Update building exposure content
            updateBuildingExposureContent();
            
            // Update evacuation planning content
            updateEvacuationPlanningContent();
            
            // Update fairness analytics content
            updateFairnessAnalyticsContent();
            
            // Update AI reports content
            updateAIReportsContent();
            
            // Update data sources content
            updateDataSourcesContent();
            
            // Update building breakdown
            updateBuildingBreakdown();
        }
        
        function updateHighRiskAreasTable() {
            const tableBody = document.getElementById('highRiskTableBody');
            if (!tableBody) return;
            
            const districts = getDistrictLabelsForRegion();
            tableBody.innerHTML = '';
            
            for (let i = 0; i < Math.min(4, districts.length); i++) {
                const depth = (dummyData.maxDepth - (i * 0.3)).toFixed(1);
                const buildings = Math.floor(dummyData.buildingsAtRisk * (0.3 - (i * 0.05)));
                const time = 48 + (i * 12);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${districts[i]}</td>
                    <td style="color: ${depth > 2 ? 'var(--warning-red)' : depth > 1 ? 'var(--alert-orange)' : '#28a745'};">${depth}m</td>
                    <td>${buildings.toLocaleString()}</td>
                    <td>${time}-${time + 24} hours</td>
                `;
                tableBody.appendChild(row);
            }
        }
        
        function updateWarningSystemContent() {
            // Update warning alert box
            const alertBox = document.getElementById('warningAlertText');
            if (alertBox) {
                alertBox.innerHTML = `<strong>URGENT: FLOOD WARNING LEVEL 3 ISSUED</strong> - ${dummyData.name}. Expected flood depth: ${(dummyData.maxDepth - 0.3).toFixed(1)}-${dummyData.maxDepth.toFixed(1)} meters within 48-72 hours. ${dummyData.peopleAtRisk.toLocaleString()} people at risk, ${dummyData.buildingsAtRisk.toLocaleString()} buildings affected. Evacuation centers activated.`;
            }
            
            // Update simple warning
            const simpleTitle = document.getElementById('simpleWarningTitle');
            const simpleTime = document.getElementById('simpleWarningTime');
            const simpleHeight = document.getElementById('simpleWarningHeight');
            const simpleAffected = document.getElementById('simpleWarningAffected');
            
            if (simpleTitle) simpleTitle.textContent = 'FLOOD ALERT! WATER RISING';
            if (simpleTime) simpleTime.textContent = '2-3 DAYS';
            if (simpleHeight) simpleHeight.textContent = dummyData.maxDepth > 2 ? 'ABOVE HEAD LEVEL' : 'ABOVE WAIST LEVEL';
            if (simpleAffected) simpleAffected.textContent = 'GROUND FLOORS OF HOUSES';
            
            // Update responder briefing
            const responderTitle = document.getElementById('responderBriefingTitle');
            const responderDepth = document.getElementById('responderDepth');
            const responderPopulation = document.getElementById('responderPopulation');
            const responderBuildings = document.getElementById('responderBuildings');
            const responderInfrastructure = document.getElementById('responderInfrastructure');
            const responderShelters = document.getElementById('responderShelters');
            const responderActions = document.getElementById('responderActions');
            
            if (responderTitle) responderTitle.textContent = `Flood Impact Forecast - ${dummyData.name}`;
            if (responderDepth) responderDepth.textContent = `${(dummyData.maxDepth - 0.3).toFixed(1)}-${dummyData.maxDepth.toFixed(1)} meters`;
            if (responderPopulation) responderPopulation.textContent = `~${dummyData.peopleAtRisk.toLocaleString()} people`;
            if (responderBuildings) responderBuildings.textContent = `${dummyData.buildingsAtRisk.toLocaleString()} buildings`;
            if (responderInfrastructure) responderInfrastructure.textContent = `${Math.floor(dummyData.buildingsAtRisk/5000)} schools, ${Math.floor(dummyData.buildingsAtRisk/15000)} health clinics, ${Math.floor(dummyData.buildingsAtRisk/30000)} bridges`;
            if (responderShelters) responderShelters.textContent = `${Math.floor(dummyData.peopleAtRisk/10000)} centers (Capacity: ${Math.floor(dummyData.peopleAtRisk/5).toLocaleString()})`;
            if (responderActions) responderActions.textContent = 'Evacuate low-lying areas, secure utilities, preposition supplies';
            
            // Update economic impact
            const economicTitle = document.getElementById('economicImpactTitle');
            const economicProperty = document.getElementById('economicProperty');
            const economicAgriculture = document.getElementById('economicAgriculture');
            const economicInfrastructure = document.getElementById('economicInfrastructure');
            const economicBuildings = document.getElementById('economicBuildings');
            const economicTotal = document.getElementById('economicTotal');
            const economicActions = document.getElementById('economicActions');
            
            if (economicTitle) economicTitle.textContent = `Economic Impact Assessment - ${dummyData.name}`;
            if (economicProperty) economicProperty.textContent = `$${Math.floor(dummyData.buildingsAtRisk * 1500).toLocaleString()}`;
            if (economicAgriculture) economicAgriculture.textContent = `$${Math.floor(dummyData.buildingsAtRisk * 300).toLocaleString()}`;
            if (economicInfrastructure) economicInfrastructure.textContent = `$${Math.floor(dummyData.buildingsAtRisk * 400).toLocaleString()}`;
            if (economicBuildings) economicBuildings.textContent = `$${Math.floor(dummyData.buildingsAtRisk * 1000).toLocaleString()}`;
            if (economicTotal) {
                const total = dummyData.buildingsAtRisk * 3200;
                economicTotal.textContent = `$${Math.floor(total).toLocaleString()}`;
            }
            if (economicActions) economicActions.textContent = 'Activate emergency funds, insurance mechanisms';
            
            // Update warning strategy
            const strategyContent = document.getElementById('warningStrategyContent');
            if (strategyContent) {
                strategyContent.innerHTML = `
                    <p><strong>Warning Dissemination Strategy for ${dummyData.name}</strong></p>
                    <p><strong>Target Audience Segmentation:</strong></p>
                    <ul>
                        <li><strong>General Public (Low literacy):</strong> Icon-based SMS, community loudspeakers, simple radio messages</li>
                        <li><strong>Farmers & Fishers:</strong> Agricultural extension networks, fisher group notifications</li>
                        <li><strong>Remote Communities:</strong> Boat-based warning teams, flag systems, emergency shelters</li>
                        <li><strong>Local Government:</strong> Detailed impact forecasts, resource allocation plans</li>
                        <li><strong>Emergency Responders:</strong> Real-time situation updates, resource deployment maps</li>
                    </ul>
                    <p><strong>Communication Channels:</strong> SMS (${Math.floor(dummyData.peopleAtRisk * 0.8).toLocaleString()}), Radio (${Math.floor(dummyData.peopleAtRisk/50000)} stations), Loudspeakers (${Math.floor(dummyData.peopleAtRisk/5000)} villages), Mobile apps (${Math.floor(dummyData.peopleAtRisk * 0.2).toLocaleString()} users), Social media, Community leaders</p>
                    <p><strong>Message Frequency:</strong> Every 6 hours (general), Every 2 hours (high-risk areas), Continuous (emergency responders)</p>
                `;
            }
        }
        
        function updateBuildingExposureContent() {
            // Update metrics
            const buildingTotal = document.getElementById('buildingTotal');
            const buildingResidential = document.getElementById('buildingResidential');
            const buildingDamage = document.getElementById('buildingDamage');
            const buildingCritical = document.getElementById('buildingCritical');
            
            if (buildingTotal) buildingTotal.textContent = dummyData.buildingsAtRisk.toLocaleString();
            if (buildingResidential) buildingResidential.textContent = Math.floor(dummyData.buildingsAtRisk * 0.85).toLocaleString();
            if (buildingDamage) {
                const damage = dummyData.buildingsAtRisk * 1500;
                buildingDamage.textContent = `$${Math.floor(damage/1000000)}-${Math.floor(damage*1.2/1000000)}M`;
            }
            if (buildingCritical) buildingCritical.textContent = Math.floor(dummyData.buildingsAtRisk/2000);
        }
        
        function updateBuildingBreakdown() {
            const buildingBreakdown = document.getElementById('buildingBreakdown');
            if (buildingBreakdown) {
                const residential = Math.floor(dummyData.buildingsAtRisk * 0.85);
                const commercial = Math.floor(dummyData.buildingsAtRisk * 0.10);
                const industrial = Math.floor(dummyData.buildingsAtRisk * 0.03);
                const publicBuildings = Math.floor(dummyData.buildingsAtRisk * 0.02);
                
                buildingBreakdown.innerHTML = `
                    <div class="building-type residential">
                        <h4>Residential</h4>
                        <div class="building-stat-value">${residential.toLocaleString()}</div>
                        <div class="building-stat-label">Buildings</div>
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.9rem;">Damage Estimate:</div>
                            <div style="font-weight: bold; color: var(--warning-red);">$${Math.floor(residential * 1500).toLocaleString()}</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem;">
                            <i class="fas fa-users"></i> ~${Math.floor(residential * 5).toLocaleString()} residents affected
                        </div>
                    </div>
                    
                    <div class="building-type commercial">
                        <h4>Commercial</h4>
                        <div class="building-stat-value">${commercial.toLocaleString()}</div>
                        <div class="building-stat-label">Buildings</div>
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.9rem;">Damage Estimate:</div>
                            <div style="font-weight: bold; color: var(--warning-red);">$${Math.floor(commercial * 2500).toLocaleString()}</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem;">
                            <i class="fas fa-store"></i> Shops, markets, offices
                        </div>
                    </div>
                    
                    <div class="building-type industrial">
                        <h4>Industrial</h4>
                        <div class="building-stat-value">${industrial.toLocaleString()}</div>
                        <div class="building-stat-label">Buildings</div>
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.9rem;">Damage Estimate:</div>
                            <div style="font-weight: bold; color: var(--warning-red);">$${Math.floor(industrial * 5000).toLocaleString()}</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem;">
                            <i class="fas fa-industry"></i> Factories, warehouses
                        </div>
                    </div>
                    
                    <div class="building-type public">
                        <h4>Public</h4>
                        <div class="building-stat-value">${publicBuildings.toLocaleString()}</div>
                        <div class="building-stat-label">Buildings</div>
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.9rem;">Damage Estimate:</div>
                            <div style="font-weight: bold; color: var(--warning-red);">$${Math.floor(publicBuildings * 2000).toLocaleString()}</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem;">
                            <i class="fas fa-school"></i> Schools, clinics, govt. buildings
                        </div>
                    </div>
                `;
            }
            
            // Update building report
            const buildingReport = document.getElementById('buildingReportContent');
            if (buildingReport) {
                buildingReport.innerHTML = `
                    <div class="report-section">
                        <h4>1. Methodology for ${dummyData.name}</h4>
                        <p><strong>Data Sources:</strong></p>
                        <div>
                            <span class="data-source-badge">OpenStreetMap Building Footprints</span>
                            <span class="data-source-badge">Microsoft Building Footprints</span>
                            <span class="data-source-badge">Local Government Data</span>
                            <span class="data-source-badge">Digital Elevation Model (SRTM)</span>
                            <span class="data-source-badge">Historical Flood Extents</span>
                        </div>
                        <p><strong>Processing Pipeline:</strong></p>
                        <ol>
                            <li>Building footprints intersected with predicted flood extent</li>
                            <li>Each building assigned flood depth based on DEM and water surface model</li>
                            <li>Building type classification using ML (85% accuracy)</li>
                            <li>Damage estimation using depth-damage functions from FEMA/World Bank</li>
                            <li>Vulnerability scoring based on construction type and elevation</li>
                        </ol>
                    </div>
                    
                    <div class="report-section">
                        <h4>2. Key Findings for ${dummyData.name}</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Value</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Total Buildings in Flood Zone</td>
                                    <td>${dummyData.buildingsAtRisk.toLocaleString()}</td>
                                    <td>${Math.floor(dummyData.buildingsAtRisk/5000)}% of regional building stock</td>
                                </tr>
                                <tr>
                                    <td>Residential Buildings</td>
                                    <td>${Math.floor(dummyData.buildingsAtRisk * 0.85).toLocaleString()} (85%)</td>
                                    <td>~${Math.floor(dummyData.buildingsAtRisk * 0.85 * 5).toLocaleString()} residents potentially affected</td>
                                </tr>
                                <tr>
                                    <td>Critical Infrastructure</td>
                                    <td>${Math.floor(dummyData.buildingsAtRisk/2000)} facilities</td>
                                    <td>Schools, health clinics, bridges, government offices</td>
                                </tr>
                                <tr>
                                    <td>Estimated Building Damage</td>
                                    <td>$${Math.floor(dummyData.buildingsAtRisk * 1500).toLocaleString()}</td>
                                    <td>Residential: $${Math.floor(dummyData.buildingsAtRisk * 0.85 * 1500).toLocaleString()}</td>
                                </tr>
                                <tr>
                                    <td>Most Vulnerable Building Type</td>
                                    <td>Single-story mud houses</td>
                                    <td>Structural failure likely at ${dummyData.maxDepth > 2 ? '1.5m+' : '1.0m+'} depth</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h4>3. Priority Actions</h4>
                        <ul>
                            <li><strong>Immediate (0-24 hours):</strong> Evacuate single-story residential buildings in high-risk zones</li>
                            <li><strong>Short-term (24-48 hours):</strong> Secure critical infrastructure, pre-position building repair materials</li>
                            <li><strong>Medium-term (48+ hours):</strong> Activate insurance mechanisms, plan for temporary shelters</li>
                            <li><strong>Long-term:</strong> Update building codes, implement flood-resilient construction guidelines</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        function initializeEvacuationContent() {
            const evacuationAlertBox = document.getElementById('evacuationAlertBox');
            if (evacuationAlertBox) {
                evacuationAlertBox.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>EVACUATION PRIORITY 1:</strong> ${Math.floor(dummyData.peopleAtRisk * 0.2).toLocaleString()} people in high-risk areas require immediate evacuation (within 24 hours). ${Math.floor(dummyData.peopleAtRisk/10000)} evacuation centers activated.
                    </div>
                `;
            }
            
            // Initialize evacuation metrics
            const evacuationMetrics = document.getElementById('evacuationMetrics');
            if (evacuationMetrics) {
                evacuationMetrics.innerHTML = `
                    <div class="evacuation-metric priority-high">
                        <h4>Priority 1</h4>
                        <div class="metric-value">${Math.floor(dummyData.peopleAtRisk * 0.2).toLocaleString()}</div>
                        <div class="metric-label">People to Evacuate</div>
                        <div style="font-size: 0.8rem; margin-top: 5px;">Within 24 hours</div>
                    </div>
                    <div class="evacuation-metric priority-medium">
                        <h4>Priority 2</h4>
                        <div class="metric-value">${Math.floor(dummyData.peopleAtRisk * 0.3).toLocaleString()}</div>
                        <div class="metric-label">People to Evacuate</div>
                        <div style="font-size: 0.8rem; margin-top: 5px;">Within 48 hours</div>
                    </div>
                    <div class="evacuation-metric priority-low">
                        <h4>Priority 3</h4>
                        <div class="metric-value">${Math.floor(dummyData.peopleAtRisk * 0.3).toLocaleString()}</div>
                        <div class="metric-label">People to Evacuate</div>
                        <div style="font-size: 0.8rem; margin-top: 5px;">Within 72 hours</div>
                    </div>
                `;
            }
            
            // Initialize evacuation factors
            const evacuationFactors = document.getElementById('evacuationFactors');
            if (evacuationFactors) {
                evacuationFactors.innerHTML = `
                    <li><strong>Flood Depth:</strong> Areas with predicted depth > ${dummyData.maxDepth * 0.7}m</li>
                    <li><strong>Population Density:</strong> High-density settlements (>1000 people/kmÂ²)</li>
                    <li><strong>Vulnerability:</strong> Elderly, children, disabled populations</li>
                    <li><strong>Infrastructure:</strong> Critical facilities (schools, hospitals)</li>
                    <li><strong>Accessibility:</strong> Road connectivity and evacuation routes</li>
                    <li><strong>Shelter Capacity:</strong> Proximity to available shelters</li>
                `;
            }
            
            // Initialize evacuation flowchart
            const evacuationFlowchart = document.getElementById('evacuationFlowchart');
            if (evacuationFlowchart) {
                evacuationFlowchart.innerHTML = `
                    <div class="flowchart-step">
                        <h4>Step 1: Risk Assessment</h4>
                        <p>AI analyzes flood predictions and building vulnerability</p>
                    </div>
                    <div class="flowchart-arrow"></div>
                    <div class="flowchart-step">
                        <h4>Step 2: Priority Ranking</h4>
                        <p>Communities ranked based on risk factors and vulnerability</p>
                    </div>
                    <div class="flowchart-arrow"></div>
                    <div class="flowchart-step">
                        <h4>Step 3: Route Planning</h4>
                        <p>Optimal evacuation routes calculated using road networks</p>
                    </div>
                    <div class="flowchart-arrow"></div>
                    <div class="flowchart-step">
                        <h4>Step 4: Resource Allocation</h4>
                        <p>Transport and shelter resources assigned based on needs</p>
                    </div>
                    <div class="flowchart-arrow"></div>
                    <div class="flowchart-step">
                        <h4>Step 5: Execution & Monitoring</h4>
                        <p>Real-time tracking of evacuation progress</p>
                    </div>
                `;
            }
            
            // Initialize evacuation plan table
            const evacuationPlanTable = document.getElementById('evacuationPlanTable');
            if (evacuationPlanTable) {
                const districts = getDistrictLabelsForRegion().slice(0, 5);
                evacuationPlanTable.innerHTML = `
                    <thead>
                        <tr>
                            <th>District</th>
                            <th>Priority</th>
                            <th>People to Evacuate</th>
                            <th>Shelters Assigned</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${districts.map((district, i) => `
                            <tr>
                                <td>${district}</td>
                                <td>${i < 2 ? 'High' : i < 4 ? 'Medium' : 'Low'}</td>
                                <td>${Math.floor(dummyData.peopleAtRisk * (0.15 - i * 0.02)).toLocaleString()}</td>
                                <td>${Math.floor(dummyData.peopleAtRisk * (0.15 - i * 0.02) / 2000)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
            }
            
            // Initialize transport requirements
            const transportRequirements = document.getElementById('transportRequirements');
            if (transportRequirements) {
                transportRequirements.innerHTML = `
                    <div class="evacuation-metric">
                        <h4>Buses Required</h4>
                        <div class="metric-value">${Math.floor(dummyData.peopleAtRisk * 0.8 / 50)}</div>
                        <div class="metric-label">50-seater buses</div>
                    </div>
                    <div class="evacuation-metric">
                        <h4>Boats Required</h4>
                        <div class="metric-value">${Math.floor(dummyData.peopleAtRisk * 0.2 / 20)}</div>
                        <div class="metric-label">20-person boats</div>
                    </div>
                    <div class="evacuation-metric">
                        <h4>Trucks Required</h4>
                        <div class="metric-value">${Math.floor(dummyData.peopleAtRisk * 0.1 / 30)}</div>
                        <div class="metric-label">For supplies</div>
                    </div>
                `;
            }
            
            // Initialize evacuation timeline
            const evacuationTimelineTable = document.getElementById('evacuationTimelineTable');
            if (evacuationTimelineTable) {
                evacuationTimelineTable.innerHTML = `
                    <thead>
                        <tr>
                            <th>Time Window</th>
                            <th>Priority Level</th>
                            <th>Target Completion</th>
                            <th>People to Evacuate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0-24 hours</td>
                            <td><span style="color: var(--warning-red); font-weight: bold;">HIGH</span></td>
                            <td>90%</td>
                            <td>${Math.floor(dummyData.peopleAtRisk * 0.2).toLocaleString()}</td>
                        </tr>
                        <tr>
                            <td>24-48 hours</td>
                            <td><span style="color: var(--alert-orange); font-weight: bold;">MEDIUM</span></td>
                            <td>85%</td>
                            <td>${Math.floor(dummyData.peopleAtRisk * 0.3).toLocaleString()}</td>
                        </tr>
                        <tr>
                            <td>48-72 hours</td>
                            <td><span style="color: #ffc107; font-weight: bold;">LOW</span></td>
                            <td>80%</td>
                            <td>${Math.floor(dummyData.peopleAtRisk * 0.3).toLocaleString()}</td>
                        </tr>
                    </tbody>
                `;
            }
        }
        
        function updateEvacuationPlanningContent() {
            // This is already initialized in initializeEvacuationContent
        }
        
        function initializeFairnessContent() {
            // Update equity metrics
            const equityMetrics = document.getElementById('equityMetrics');
            if (equityMetrics) {
                equityMetrics.innerHTML = `
                    <div class="data-point">
                        <span class="data-label">Warning Time Difference</span>
                        <span class="data-value decline">${dummyData.warningTimeDiff} hours</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Missed Warning Rate</span>
                        <span class="data-value decline">+${dummyData.missedWarningRate}% higher</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Message Comprehension Gap</span>
                        <span class="data-value decline">${dummyData.comprehensionGap}% lower</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Evacuation Rate Difference</span>
                        <span class="data-value decline">${dummyData.evacuationRateDiff}% lower</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Building Damage Prediction Accuracy</span>
                        <span class="data-value decline">${dummyData.damageAccuracyDiff}m less accurate</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Overall Fairness Score</span>
                        <span class="data-value" style="color: ${dummyData.fairnessScore >= 80 ? '#28a745' : dummyData.fairnessScore >= 70 ? '#ff9800' : '#e63946'}; font-weight: bold;">${dummyData.fairnessScore}/100</span>
                    </div>
                `;
            }
            
            // Initialize vulnerable groups
            const vulnerableGroups = document.getElementById('vulnerableGroups');
            if (vulnerableGroups) {
                vulnerableGroups.innerHTML = `
                    <div class="data-point">
                        <span class="data-label">Rural Agricultural Communities</span>
                        <span class="data-value">${Math.floor(dummyData.peopleAtRisk * 0.4).toLocaleString()} people</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Urban Informal Settlements</span>
                        <span class="data-value">${Math.floor(dummyData.peopleAtRisk * 0.25).toLocaleString()} people</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Riverine (Char) Communities</span>
                        <span class="data-value">${Math.floor(dummyData.peopleAtRisk * 0.2).toLocaleString()} people</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Indigenous/Tribal Groups</span>
                        <span class="data-value">${Math.floor(dummyData.peopleAtRisk * 0.1).toLocaleString()} people</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">People with Disabilities</span>
                        <span class="data-value">${Math.floor(dummyData.peopleAtRisk * 0.05).toLocaleString()} people</span>
                    </div>
                `;
            }
            
            // Initialize equity report
            const equityReportContent = document.getElementById('equityReportContent');
            if (equityReportContent) {
                equityReportContent.innerHTML = `
                    <div class="report-section">
                        <h4>Equity Audit Report - ${dummyData.name}</h4>
                        <p><strong>Audit Date:</strong> ${new Date().toLocaleDateString()}</p>
                        <p><strong>Overall Fairness Score:</strong> <span style="color: ${dummyData.fairnessScore >= 80 ? '#28a745' : dummyData.fairnessScore >= 70 ? '#ff9800' : '#e63946'}; font-weight: bold;">${dummyData.fairnessScore}/100</span></p>
                    </div>
                    
                    <div class="report-section">
                        <h4>Key Disparities Identified</h4>
                        <table class="matrix-table">
                            <thead>
                                <tr>
                                    <th>Vulnerable Group</th>
                                    <th>Warning Time Gap</th>
                                    <th>Message Reach Gap</th>
                                    <th>Comprehension Gap</th>
                                    <th>Risk Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Rural Agricultural</td>
                                    <td class="risk-high">-${Math.abs(dummyData.warningTimeDiff)} hrs</td>
                                    <td class="risk-medium">+${dummyData.missedWarningRate}%</td>
                                    <td class="risk-high">${dummyData.comprehensionGap}%</td>
                                    <td class="risk-high">High</td>
                                </tr>
                                <tr>
                                    <td>Urban Informal</td>
                                    <td class="risk-medium">-${Math.abs(dummyData.warningTimeDiff * 0.8).toFixed(1)} hrs</td>
                                    <td class="risk-low">+${(dummyData.missedWarningRate * 0.6).toFixed(1)}%</td>
                                    <td class="risk-medium">${(dummyData.comprehensionGap * 0.7).toFixed(0)}%</td>
                                    <td class="risk-medium">Medium</td>
                                </tr>
                                <tr>
                                    <td>Riverine (Char)</td>
                                    <td class="risk-high">-${Math.abs(dummyData.warningTimeDiff * 1.2).toFixed(1)} hrs</td>
                                    <td class="risk-high">+${(dummyData.missedWarningRate * 1.3).toFixed(1)}%</td>
                                    <td class="risk-high">${(dummyData.comprehensionGap * 1.1).toFixed(0)}%</td>
                                    <td class="risk-high">High</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h4>Recommended Corrective Actions</h4>
                        <div class="recommendations-grid">
                            <div class="recommendation-card immediate">
                                <h5>Immediate Actions (0-7 days)</h5>
                                <ul>
                                    <li>Deploy mobile warning teams to remote communities</li>
                                    <li>Activate community radio in local languages</li>
                                    <li>Distribute icon-based warning cards</li>
                                </ul>
                            </div>
                            <div class="recommendation-card short-term">
                                <h5>Short-term Actions (7-30 days)</h5>
                                <ul>
                                    <li>Train community volunteers as warning disseminators</li>
                                    <li>Establish community-based early warning systems</li>
                                    <li>Improve last-mile communication infrastructure</li>
                                </ul>
                            </div>
                            <div class="recommendation-card medium-term">
                                <h5>Medium-term Actions (1-6 months)</h5>
                                <ul>
                                    <li>Develop tailored warning messages for different groups</li>
                                    <li>Integrate traditional knowledge with modern systems</li>
                                    <li>Build trust through community engagement</li>
                                </ul>
                            </div>
                            <div class="recommendation-card long-term">
                                <h5>Long-term Actions (6+ months)</h5>
                                <ul>
                                    <li>Institutionalize equity monitoring in warning systems</li>
                                    <li>Build inclusive disaster management policies</li>
                                    <li>Invest in resilient communication infrastructure</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function updateFairnessAnalyticsContent() {
            // This is already initialized in initializeFairnessContent
        }
        
        function initializeAIReports() {
            const aiReportContainer = document.getElementById('aiReportContainer');
            if (aiReportContainer) {
                aiReportContainer.innerHTML = `
                    <div class="report-section">
                        <h4><span class="sticker">ðŸš¨</span> 1. Emergency Alert Report (Priority: HIGH) - ${dummyData.name}</h4>
                        <p><strong>Report ID:</strong> FLOOD-ALERT-${Date.now().toString().slice(-6)}</p>
                        <p><strong>Generated:</strong> ${new Date().toLocaleDateString()}, ${new Date().toLocaleTimeString()}</p>
                        <p><strong>Location:</strong> ${dummyData.name}</p>
                        <p><strong>Risk Level:</strong> HIGH (Red Alert)</p>
                        <p><strong>Predicted Flood Depth:</strong> ${(dummyData.maxDepth - 0.3).toFixed(1)}-${dummyData.maxDepth.toFixed(1)} meters (70-80% confidence)</p>
                        <p><strong>Timeline:</strong> Initial flooding in 48-72 hours, peak in 60-84 hours</p>
                        <p><strong>Affected Area:</strong> ${Math.floor(dummyData.buildingsAtRisk/200)} kmÂ²</p>
                        <p><strong>People at Risk:</strong> ~${dummyData.peopleAtRisk.toLocaleString()} (${Math.floor(dummyData.peopleAtRisk/10000)}% of regional population)</p>
                        <p><strong>Buildings at Risk:</strong> ${dummyData.buildingsAtRisk.toLocaleString()}</p>
                        <p><strong>Critical Infrastructure:</strong> ${Math.floor(dummyData.buildingsAtRisk/2000)} schools, ${Math.floor(dummyData.buildingsAtRisk/5000)} health clinics, ${Math.floor(dummyData.buildingsAtRisk/10000)} bridges</p>
                        <p><strong>Estimated Economic Impact:</strong> $${Math.floor(dummyData.buildingsAtRisk * 3200).toLocaleString()} (building damage: $${Math.floor(dummyData.buildingsAtRisk * 1500).toLocaleString()}, agriculture: $${Math.floor(dummyData.buildingsAtRisk * 300).toLocaleString()}, infrastructure: $${Math.floor(dummyData.buildingsAtRisk * 400).toLocaleString()})</p>
                        <p><strong>AI Confidence Level:</strong> ${dummyData.accuracy}%</p>
                        <p><strong>Recommended Immediate Actions:</strong></p>
                        <ul>
                            <li>Activate evacuation centers (${Math.floor(dummyData.peopleAtRisk/10000)} centers, capacity: ${Math.floor(dummyData.peopleAtRisk/5).toLocaleString()})</li>
                            <li>Prioritize evacuation of high-risk communities (${Math.floor(dummyData.peopleAtRisk * 0.2).toLocaleString()} people)</li>
                            <li>Secure critical infrastructure (schools, clinics, bridges)</li>
                            <li>Pre-position emergency supplies (food, water, medicine)</li>
                            <li>Deploy mobile medical teams to high-risk areas</li>
                        </ul>
                    </div>
                    
                    <div class="report-section">
                        <h4><span class="sticker">ðŸ“Š</span> 2. Technical Briefing for Disaster Management Agency</h4>
                        <p><strong>Report ID:</strong> TECH-BRIEF-${Date.now().toString().slice(-6)}</p>
                        <p><strong>Federated Learning Model Status:</strong></p>
                        <ul>
                            <li>Model Accuracy: ${dummyData.accuracy}%</li>
                            <li>Training Rounds Completed: ${dummyData.flRounds}</li>
                            <li>Privacy Protection: Îµ=1.2 (Strong differential privacy)</li>
                            <li>Data Sovereignty: 100% preserved</li>
                        </ul>
                        <p><strong>Data Sources Integration Status:</strong></p>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Data Source</th>
                                    <th>Status</th>
                                    <th>Update Frequency</th>
                                    <th>Coverage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Satellite Imagery (Sentinel-1)</td>
                                    <td style="color: #28a745;">Active</td>
                                    <td>6 hours</td>
                                    <td>100% of basin</td>
                                </tr>
                                <tr>
                                    <td>River Gauge Stations</td>
                                    <td style="color: #28a745;">87% reporting</td>
                                    <td>30 minutes</td>
                                    <td>Major rivers</td>
                                </tr>
                                <tr>
                                    <td>Rainfall Radar</td>
                                    <td style="color: #28a745;">Active</td>
                                    <td>15 minutes</td>
                                    <td>${currentCountry === 'india' ? 'IMD' : currentCountry === 'bangladesh' ? 'BMD' : 'DHM'} coverage</td>
                                </tr>
                                <tr>
                                    <td>Building Footprints</td>
                                    <td style="color: #28a745;">Updated</td>
                                    <td>Quarterly</td>
                                    <td>${Math.floor(dummyData.buildingsAtRisk/1000)}K buildings in risk zone</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h4><span class="sticker">ðŸŽ“</span> 3. Research Summary for Academic Review</h4>
                        <p><strong>Research Question:</strong> Can privacy-preserving AI improve flood warnings while respecting data sovereignty?</p>
                        <p><strong>Methodology:</strong> Federated learning with differential privacy across India, Nepal, Bangladesh</p>
                        <p><strong>Key Findings:</strong></p>
                        <ul>
                            <li>Federated model achieves ${dummyData.accuracy}% accuracy (only 0.9% less than centralized)</li>
                            <li>Warning lead time improved by 8.2 hours compared to country-specific models</li>
                            <li>100% data sovereignty preserved through federated learning</li>
                            <li>Equity monitoring shows ${dummyData.fairnessScore}/100 fairness score</li>
                            <li>System protects ${dummyData.peopleAtRisk.toLocaleString()} people in ${dummyData.name}</li>
                        </ul>
                        <p><strong>Policy Implications:</strong> This research demonstrates that transboundary flood forecasting is possible without compromising national data sovereignty, enabling better cooperation in the GBM basin.</p>
                    </div>
                `;
            }
        }
        
        function updateAIReportsContent() {
            // This is already initialized in initializeAIReports
        }
        
        function initializeDataSources() {
            // Update data sources based on region
            const satelliteData = document.getElementById('satelliteData');
            const insituData = document.getElementById('insituData');
            const buildingData = document.getElementById('buildingData');
            
            if (satelliteData) {
                satelliteData.innerHTML = `
                    <div class="data-point">
                        <span class="data-label">Sentinel-1 SAR</span>
                        <span class="data-value">Flood extent, water detection</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Sentinel-2 Optical</span>
                        <span class="data-value">Land cover, vegetation</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">GPM Rainfall</span>
                        <span class="data-value">Precipitation estimates</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">SRTM DEM</span>
                        <span class="data-value">Elevation data (30m resolution)</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Update Frequency</span>
                        <span class="data-value" style="color: #28a745;">1-6 hours</span>
                    </div>
                `;
            }
            
            if (insituData) {
                insituData.innerHTML = `
                    <div class="data-point">
                        <span class="data-label">River Gauge Stations</span>
                        <span class="data-value">${Math.floor(dummyData.buildingsAtRisk/500)} stations in region</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Rainfall Gauges</span>
                        <span class="data-value">${Math.floor(dummyData.buildingsAtRisk/200)} stations</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Weather Radar</span>
                        <span class="data-value">${currentCountry === 'india' ? 'IMD' : currentCountry === 'bangladesh' ? 'BMD' : 'DHM'} coverage</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Data Latency</span>
                        <span class="data-value" style="color: #28a745;">5-30 minutes</span>
                    </div>
                `;
            }
            
            if (buildingData) {
                buildingData.innerHTML = `
                    <div class="data-point">
                        <span class="data-label">OpenStreetMap</span>
                        <span class="data-value">Building footprints, roads</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Microsoft Building Footprints</span>
                        <span class="data-value">AI-detected buildings</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Local Government Data</span>
                        <span class="data-value">Building registers, land use</span>
                    </div>
                    <div class="data-point">
                        <span class="data-label">Data Currency</span>
                        <span class="data-value" style="color: #28a745;">Updated quarterly</span>
                    </div>
                `;
            }
            
            // Initialize data integration report
            const dataIntegrationReport = document.getElementById('dataIntegrationReport');
            if (dataIntegrationReport) {
                dataIntegrationReport.innerHTML = `
                    <div class="report-section">
                        <h4>Data Integration Architecture</h4>
                        <p><strong>Federated Learning Framework:</strong></p>
                        <ul>
                            <li><strong>Nepal Node:</strong> Processes snowmelt and mountain rainfall data locally</li>
                            <li><strong>India Node:</strong> Processes river flow and reservoir data locally</li>
                            <li><strong>Bangladesh Node:</strong> Processes flood impact and damage data locally</li>
                            <li><strong>Secure Aggregation:</strong> Only model parameters (not raw data) are shared</li>
                            <li><strong>Differential Privacy:</strong> Îµ=1.2 noise added to protect individual data points</li>
                        </ul>
                    </div>
                    
                    <div class="report-section">
                        <h4>Data Processing Pipeline</h4>
                        <ol>
                            <li><strong>Data Ingestion:</strong> Satellite, gauge, radar data collected locally in each country</li>
                            <li><strong>Local Processing:</strong> Data cleaned, normalized, and features extracted</li>
                            <li><strong>Local Training:</strong> AI model trained on local data with privacy protection</li>
                            <li><strong>Secure Model Sharing:</strong> Encrypted model updates sent to aggregation server</li>
                            <li><strong>Global Model Aggregation:</strong> Federated averaging creates improved global model</li>
                            <li><strong>Model Distribution:</strong> Improved model shared back to all countries</li>
                            <li><strong>Inference & Prediction:</strong> Each country runs predictions locally</li>
                        </ol>
                    </div>
                    
                    <div class="report-section">
                        <h4>Privacy & Security Measures</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Measure</th>
                                    <th>Implementation</th>
                                    <th>Protection Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Data Sovereignty</td>
                                    <td>Raw data never leaves country borders</td>
                                    <td style="color: #28a745;">100%</td>
                                </tr>
                                <tr>
                                    <td>Differential Privacy</td>
                                    <td>Îµ=1.2 Gaussian noise added to model updates</td>
                                    <td style="color: #28a745;">Strong</td>
                                </tr>
                                <tr>
                                    <td>Secure Aggregation</td>
                                    <td>Homomorphic encryption for model parameter aggregation</td>
                                    <td style="color: #28a745;">Military-grade</td>
                                </tr>
                                <tr>
                                    <td>Access Control</td>
                                    <td>Role-based access with multi-factor authentication</td>
                                    <td style="color: #28a745;">High</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }
        
        function updateDataSourcesContent() {
            // This is already initialized in initializeDataSources
        }
        
        // Tab switching functionality
        function setupTabSwitching() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and tab contents
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Show corresponding tab content
                    const tabId = tab.getAttribute('data-tab');
                    const tabContent = document.getElementById(tabId);
                    tabContent.classList.add('active');
                    
                    // Initialize tab-specific content
                    switch(tabId) {
                        case 'dashboard':
                            if (!initializedTabs.dashboard) {
                                initializeDashboardCharts();
                                initializedTabs.dashboard = true;
                            }
                            break;
                        case 'map':
                            if (!initializedTabs.map) {
                                setTimeout(initializeMap, 100);
                                initializedTabs.map = true;
                            }
                            break;
                        case 'analytical-graphs':
                            if (!initializedTabs.analyticalGraphs) {
                                setTimeout(() => {
                                    initializeAnalyticalCharts();
                                    resizeAnalyticalCharts();
                                }, 100);
                                initializedTabs.analyticalGraphs = true;
                            } else {
                                resizeAnalyticalCharts();
                            }
                            break;
                        case 'buildings':
                            if (!initializedTabs.buildings) {
                                setTimeout(initializeBuildingCharts, 100);
                                initializedTabs.buildings = true;
                            }
                            break;
                        case 'fl':
                            if (!initializedTabs.fl) {
                                setTimeout(initializeFLCharts, 100);
                                initializedTabs.fl = true;
                            }
                            break;
                        case 'evacuation':
                            if (!initializedTabs.evacuation) {
                                setTimeout(initializeEvacuationCharts, 100);
                                initializedTabs.evacuation = true;
                            }
                            break;
                        case 'fairness':
                            if (!initializedTabs.fairness) {
                                setTimeout(initializeFairnessChart, 100);
                                initializedTabs.fairness = true;
                            }
                            break;
                    }
                });
            });
        }
        
        // Resize function for analytical charts
        function resizeAnalyticalCharts() {
            for (let chartName in analyticalCharts) {
                if (analyticalCharts[chartName]) {
                    try {
                        analyticalCharts[chartName].resize();
                        analyticalCharts[chartName].update();
                    } catch (e) {
                        console.log("Error resizing chart", chartName, e);
                    }
                }
            }
        }
        
        // Initialize the interactive map
        function initializeMap() {
            map = L.map('floodMap').setView(dummyData.center, dummyData.zoom);
            
            // Add OpenStreetMap base layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add terrain layer
            L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                maxZoom: 17,
                attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
            }).addTo(map);
            
            // Create region-specific layers
            createRegionSpecificLayers();
            
            // Add river layer (simplified)
            L.polyline([
                [dummyData.center[0] + 0.5, dummyData.center[1] - 0.5],
                [dummyData.center[0], dummyData.center[1]],
                [dummyData.center[0] - 0.5, dummyData.center[1] + 0.5]
            ], {
                color: '#1a5f7a',
                weight: 4,
                opacity: 0.7
            }).addTo(map).bindPopup(`<b>Main River Channel</b><br>Elevated water levels detected`);
            
            // Add warning marker
            L.marker([dummyData.center[0], dummyData.center[1]], {
                icon: L.divIcon({
                    className: 'flood-warning-marker',
                    html: '<div style="background-color: #e63946; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.5);">âš ï¸</div>',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40]
                })
            }).addTo(map).bindPopup(`<b>ACTIVE FLOOD WARNING</b><br>Evacuation advised for low-lying areas<br>${dummyData.buildingsAtRisk.toLocaleString()} buildings at risk`);
            
            // Set up map controls
            setupMapControls();
            
            // Set up depth slider for map
            const depthSlider = document.getElementById('depthSlider');
            if (depthSlider) {
                depthSlider.addEventListener('input', function() {
                    const depth = (this.value / 10).toFixed(1);
                    
                    // Update flood extent opacity based on depth
                    const opacity = 0.1 + (depth / 3) * 0.5;
                    if (floodExtentLayer) {
                        floodExtentLayer.setStyle({fillOpacity: opacity});
                    }
                    
                    // Update building risk visualization
                    if (showBuildings && buildingLayer) {
                        buildingLayer.eachLayer(function(layer) {
                            const risk = depth > 2 ? 0.8 : depth > 1 ? 0.6 : 0.4;
                            layer.setStyle({fillOpacity: risk});
                        });
                    }
                });
            }
            
            // Initialize geocoding
            setupGeocoding();
            
            // Initialize timeline chart
            initializeTimelineChart();
            
            // Update high risk areas table
            updateHighRiskAreasTable();
        }
        
        function setupMapControls() {
            const toggleBuildings = document.getElementById('toggleBuildings');
            const toggleFlood = document.getElementById('toggleFlood');
            const toggleDepth = document.getElementById('toggleDepth');
            const toggleInfrastructure = document.getElementById('toggleInfrastructure');
            const toggleFlow = document.getElementById('toggleFlow');
            
            if (toggleBuildings) {
                toggleBuildings.addEventListener('click', function() {
                    showBuildings = !showBuildings;
                    this.classList.toggle('active');
                    if (showBuildings) {
                        buildingLayer.addTo(map);
                    } else {
                        map.removeLayer(buildingLayer);
                    }
                });
            }
            
            if (toggleFlood) {
                toggleFlood.addEventListener('click', function() {
                    showFlood = !showFlood;
                    this.classList.toggle('active');
                    if (showFlood) {
                        floodExtentLayer.addTo(map);
                    } else {
                        map.removeLayer(floodExtentLayer);
                    }
                });
            }
            
            if (toggleDepth) {
                toggleDepth.addEventListener('click', function() {
                    showDepth = !showDepth;
                    this.classList.toggle('active');
                    if (showDepth) {
                        // Create depth layer if it doesn't exist
                        if (!depthLayer) {
                            const depthCoords = getFloodCoordinatesForRegion().map(coord => 
                                [coord[0] + 0.05, coord[1] + 0.05]
                            );
                            depthLayer = L.polygon(depthCoords, {
                                color: '#e63946',
                                fillColor: '#e63946',
                                fillOpacity: 0.2,
                                weight: 1
                            }).bindPopup("<b>High Flood Depth Area</b><br>Predicted depth: " + (dummyData.maxDepth * 0.8).toFixed(1) + "-" + dummyData.maxDepth.toFixed(1) + "m<br>Buildings at extreme risk");
                        }
                        depthLayer.addTo(map);
                    } else {
                        if (depthLayer) map.removeLayer(depthLayer);
                    }
                });
            }
            
            if (toggleInfrastructure) {
                toggleInfrastructure.addEventListener('click', function() {
                    showInfrastructure = !showInfrastructure;
                    this.classList.toggle('active');
                    if (showInfrastructure) {
                        infrastructureLayer.addTo(map);
                    } else {
                        map.removeLayer(infrastructureLayer);
                    }
                });
            }
            
            if (toggleFlow) {
                toggleFlow.addEventListener('click', function() {
                    showFlow = !showFlow;
                    this.classList.toggle('active');
                    if (showFlow) {
                        flowLayer.addTo(map);
                    } else {
                        map.removeLayer(flowLayer);
                    }
                });
            }
        }
        
        // ANALYTICAL GRAPHS Functions - FIXED
        function initializeAnalyticalCharts() {
            // State Exposure Chart
            const stateCtx = document.getElementById('stateExposureChart');
            if (stateCtx) {
                try {
                    analyticalCharts.stateExposureChart = new Chart(stateCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: getStateLabelsForRegion(),
                            datasets: [{
                                label: '% Area at Flood Risk',
                                data: getStateExposureDataForRegion(),
                                backgroundColor: [
                                    'rgba(230, 57, 70, 0.7)',
                                    'rgba(255, 152, 0, 0.7)',
                                    'rgba(255, 193, 7, 0.7)',
                                    'rgba(87, 197, 182, 0.7)',
                                    'rgba(26, 95, 122, 0.7)',
                                    'rgba(127, 205, 145, 0.7)',
                                    'rgba(108, 117, 125, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(230, 57, 70, 1)',
                                    'rgba(255, 152, 0, 1)',
                                    'rgba(255, 193, 7, 1)',
                                    'rgba(87, 197, 182, 1)',
                                    'rgba(26, 95, 122, 1)',
                                    'rgba(127, 205, 145, 1)',
                                    'rgba(108, 117, 125, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 50,
                                    title: {
                                        display: true,
                                        text: '% Area at Risk'
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Flood Exposure by State (ADM1)'
                                }
                            }
                        }
                    });
                    console.log("State exposure chart initialized");
                } catch (error) {
                    console.error('Error initializing stateExposureChart:', error);
                }
            }
            
            // District Population Chart - FIXED
            const districtCtx = document.getElementById('districtPopulationChart');
            if (districtCtx) {
                try {
                    analyticalCharts.districtPopulationChart = new Chart(districtCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: getDistrictLabelsForRegion(),
                            datasets: [{
                                label: 'Population at Risk (thousands)',
                                data: getDistrictPopulationDataForRegion(),
                                backgroundColor: 'rgba(26, 95, 122, 0.7)',
                                borderColor: 'rgba(26, 95, 122, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Population at Risk (thousands)'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Top 10 Districts by Population at Risk (ADM2)'
                                }
                            }
                        }
                    });
                    console.log("District population chart initialized");
                } catch (error) {
                    console.error('Error initializing districtPopulationChart:', error);
                }
            }
            
            // Population vs Flood Depth Chart
            const populationDepthCtx = document.getElementById('populationDepthChart');
            if (populationDepthCtx) {
                try {
                    analyticalCharts.populationDepthChart = new Chart(populationDepthCtx.getContext('2d'), {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                label: 'Districts',
                                data: [
                                    {x: 0.5, y: 12},
                                    {x: 0.8, y: 28},
                                    {x: 1.2, y: 65},
                                    {x: 1.5, y: 142},
                                    {x: 1.8, y: 215},
                                    {x: 2.1, y: 185},
                                    {x: 2.4, y: 156}
                                ],
                                backgroundColor: 'rgba(230, 57, 70, 0.7)',
                                borderColor: 'rgba(230, 57, 70, 1)',
                                borderWidth: 1,
                                pointRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Flood Depth (meters)'
                                    },
                                    min: 0,
                                    max: 3
                                },
                                y: {
                                    title: {
                                        display: true,
                                        text: 'Population Affected (thousands)'
                                    },
                                    min: 0,
                                    max: 250
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Population Affected vs Flood Depth Correlation'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `Depth: ${context.parsed.x}m, Population: ${context.parsed.y}K`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log("Population depth chart initialized");
                } catch (error) {
                    console.error('Error initializing populationDepthChart:', error);
                }
            }
            
            // Roads Affected Chart
            const roadsCtx = document.getElementById('roadsAffectedChart');
            if (roadsCtx) {
                try {
                    analyticalCharts.roadsAffectedChart = new Chart(roadsCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['0h', '12h', '24h', '36h', '48h', '60h', '72h', '84h', '96h'],
                            datasets: [
                                {
                                    label: 'Local Roads (km)',
                                    data: [0, 15, 42, 85, 128, 156, 185, 210, 225],
                                    borderColor: 'rgba(230, 57, 70, 1)',
                                    backgroundColor: 'rgba(230, 57, 70, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.3
                                },
                                {
                                    label: 'District Roads (km)',
                                    data: [0, 8, 25, 52, 85, 112, 135, 152, 165],
                                    borderColor: 'rgba(255, 152, 0, 1)',
                                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                                    borderWidth: 2,
                                    fill: true,
                                    tension: 0.3
                                },
                                {
                                    label: 'Highways (km)',
                                    data: [0, 0, 8, 22, 45, 68, 85, 95, 102],
                                    borderColor: 'rgba(26, 95, 122, 1)',
                                    backgroundColor: 'rgba(26, 95, 122, 0.1)',
                                    borderWidth: 2,
                                    fill: true,
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Road Length Submerged (km)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Time from Flood Onset (hours)'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Road Network Disruption Timeline'
                                }
                            }
                        }
                    });
                    console.log("Roads affected chart initialized");
                } catch (error) {
                    console.error('Error initializing roadsAffectedChart:', error);
                }
            }
            
            // Flood Impact Stacked Chart
            const stackedCtx = document.getElementById('floodImpactStackedChart');
            if (stackedCtx) {
                try {
                    analyticalCharts.floodImpactStackedChart = new Chart(stackedCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: getDistrictLabelsForRegion().slice(0, 5),
                            datasets: [
                                {
                                    label: 'Population (K)',
                                    data: [215, 142, 142, 98, 156],
                                    backgroundColor: 'rgba(230, 57, 70, 0.7)'
                                },
                                {
                                    label: 'Buildings (K)',
                                    data: [42.5, 28.3, 28.3, 19.7, 31.2],
                                    backgroundColor: 'rgba(255, 152, 0, 0.7)'
                                },
                                {
                                    label: 'Roads (km)',
                                    data: [285, 195, 185, 142, 225],
                                    backgroundColor: 'rgba(26, 95, 122, 0.7)'
                                },
                                {
                                    label: 'Agriculture (ha)',
                                    data: [12500, 8500, 9200, 6800, 10500],
                                    backgroundColor: 'rgba(87, 197, 182, 0.7)'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    stacked: true,
                                },
                                y: {
                                    stacked: true,
                                    title: {
                                        display: true,
                                        text: 'Impact Magnitude'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Multi-dimensional Flood Impact Analysis'
                                }
                            }
                        }
                    });
                    console.log("Flood impact stacked chart initialized");
                } catch (error) {
                    console.error('Error initializing floodImpactStackedChart:', error);
                }
            }
        }
        
        // Initialize dashboard charts
        function initializeDashboardCharts() {
            // Risk Timeline Chart
            const riskTimelineCtx = document.getElementById('riskTimelineChart');
            if (riskTimelineCtx) {
                try {
                    riskTimelineChart = new Chart(riskTimelineCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['Now', '+12h', '+24h', '+36h', '+48h', '+60h', '+72h', '+84h', '+96h', '+108h', '+120h'],
                            datasets: [
                                {
                                    label: 'Flood Risk Level',
                                    data: [15, 25, 45, 65, 85, 92, 95, 85, 70, 50, 30],
                                    borderColor: 'rgba(230, 57, 70, 1)',
                                    backgroundColor: 'rgba(230, 57, 70, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.3
                                },
                                {
                                    label: 'River Water Level',
                                    data: [45, 52, 65, 78, 92, 98, 100, 96, 85, 72, 60],
                                    borderColor: 'rgba(26, 95, 122, 1)',
                                    backgroundColor: 'rgba(26, 95, 122, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'Risk/Level (%)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Time from Now'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Flood Risk Timeline Prediction (Next 5 Days)'
                                }
                            }
                        }
                    });
                    console.log("Risk timeline chart initialized");
                } catch (error) {
                    console.error('Error initializing riskTimelineChart:', error);
                }
            }
        }
        
        // EVACUATION PLANNING Functions
        function initializeEvacuationCharts() {
            const shelterCtx = document.getElementById('shelterCapacityChart');
            if (shelterCtx) {
                try {
                    shelterCapacityChart = new Chart(shelterCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['Shelter Capacity', 'Required Capacity', 'Gap'],
                            datasets: [{
                                data: [84, 102.5, 18.5],
                                backgroundColor: [
                                    'rgba(87, 197, 182, 0.8)',
                                    'rgba(230, 57, 70, 0.8)',
                                    'rgba(255, 152, 0, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(87, 197, 182, 1)',
                                    'rgba(230, 57, 70, 1)',
                                    'rgba(255, 152, 0, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Shelter Capacity vs Required (thousands)'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.raw || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `${label}: ${value}K (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log("Shelter capacity chart initialized");
                } catch (error) {
                    console.error('Error initializing shelterCapacityChart:', error);
                }
            }
        }
        
        // Setup geocoding functionality
        function setupGeocoding() {
            const geocodeButton = document.getElementById('geocodeButton');
            const geocodeInput = document.getElementById('geocodeInput');
            
            if (geocodeButton && geocodeInput) {
                geocodeButton.addEventListener('click', performGeocoding);
                geocodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') performGeocoding();
                });
            }
        }
        
        function performGeocoding() {
            const input = document.getElementById('geocodeInput').value.toLowerCase();
            const resultDiv = document.getElementById('geocodeResult');
            
            if (!input.trim()) {
                resultDiv.innerHTML = `<p style="color: var(--warning-red);">Please enter a location to analyze.</p>`;
                return;
            }
            
            // For this demo, we'll just show information about the current region
            resultDiv.innerHTML = `
                <h4>Location Analysis: ${dummyData.name}</h4>
                <div class="data-point">
                    <span class="data-label">Flood Risk Level</span>
                    <span class="data-value" style="color: ${dummyData.maxDepth > 2 ? 'var(--warning-red)' : dummyData.maxDepth > 1 ? 'var(--alert-orange)' : '#28a745'};">${dummyData.maxDepth > 2 ? 'High' : dummyData.maxDepth > 1 ? 'Medium' : 'Low'}</span>
                </div>
                <div class="data-point">
                    <span class="data-label">Predicted Flood Depth</span>
                    <span class="data-value">${(dummyData.maxDepth - 0.3).toFixed(1)}-${dummyData.maxDepth.toFixed(1)}m</span>
                </div>
                <div class="data-point">
                    <span class="data-label">Buildings at Risk</span>
                    <span class="data-value">${dummyData.buildingsAtRisk.toLocaleString()}</span>
                </div>
                <div class="data-point">
                    <span class="data-label">Population at Risk</span>
                    <span class="data-value">${dummyData.peopleAtRisk.toLocaleString()}</span>
                </div>
                <div class="data-point">
                    <span class="data-label">Recommended Actions</span>
                    <span class="data-value">${dummyData.maxDepth > 2 ? 'Immediate evacuation advised' : dummyData.maxDepth > 1 ? 'Prepare for possible evacuation' : 'Monitor situation'}</span>
                </div>
            `;
            
            // Center map on region
            if (map) {
                map.setView(dummyData.center, dummyData.zoom);
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Federated Learning Performance Chart
            const flCtx = document.getElementById('flPerformanceChart');
            if (flCtx) {
                try {
                    flPerformanceChart = new Chart(flCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['Nepal', 'India', 'Bangladesh', 'Federated Model'],
                            datasets: [
                                {
                                    label: 'Centralized Model (If data shared)',
                                    data: [89.2, 91.5, 92.8, 95.1],
                                    backgroundColor: 'rgba(108, 117, 125, 0.7)',
                                    borderColor: 'rgba(108, 117, 125, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Federated Model (No data shared)',
                                    data: [88.5, 90.8, 92.1, dummyData.accuracy],
                                    backgroundColor: 'rgba(26, 95, 122, 0.7)',
                                    borderColor: 'rgba(26, 95, 122, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Country-Only Models',
                                    data: [82.1, 85.3, 87.5, 0],
                                    backgroundColor: 'rgba(230, 57, 70, 0.7)',
                                    borderColor: 'rgba(230, 57, 70, 1)',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 75,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'Prediction Accuracy (%)'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Federated Learning: Privacy-Preserving Flood Prediction'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            label += context.parsed.y + '%';
                                            if (context.dataIndex === 3 && context.datasetIndex === 1) {
                                                label += ' (Only 0.9% less than centralized)';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log("FL performance chart initialized");
                } catch (error) {
                    console.error('Error initializing flPerformanceChart:', error);
                }
            }
            
            // Fairness Assessment Chart
            const fairnessCtx = document.getElementById('fairnessChart');
            if (fairnessCtx) {
                try {
                    fairnessChart = new Chart(fairnessCtx.getContext('2d'), {
                        type: 'radar',
                        data: {
                            labels: ['Warning Lead Time', 'Message Reach', 'Comprehension', 'Evacuation Rate', 'Damage Prediction'],
                            datasets: [
                                {
                                    label: 'General Population',
                                    data: [92, 88, 85, 90, 87],
                                    backgroundColor: 'rgba(87, 197, 182, 0.2)',
                                    borderColor: 'rgba(87, 197, 182, 1)',
                                    borderWidth: 2,
                                    pointBackgroundColor: 'rgba(87, 197, 182, 1)'
                                },
                                {
                                    label: 'Vulnerable Communities',
                                    data: [79, 78, 80, 82, 75],
                                    backgroundColor: 'rgba(230, 57, 70, 0.2)',
                                    borderColor: 'rgba(230, 57, 70, 1)',
                                    borderWidth: 2,
                                    pointBackgroundColor: 'rgba(230, 57, 70, 1)'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                r: {
                                    angleLines: {
                                        display: true
                                    },
                                    suggestedMin: 50,
                                    suggestedMax: 100,
                                    ticks: {
                                        stepSize: 10
                                    },
                                    pointLabels: {
                                        font: {
                                            size: 11
                                        }
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Equity Analysis: Warning System Performance by Population Group'
                                }
                            }
                        }
                    });
                    console.log("Fairness chart initialized");
                } catch (error) {
                    console.error('Error initializing fairnessChart:', error);
                }
            }
        }
        
        // Initialize FL charts separately
        function initializeFLCharts() {
            // FL Performance Chart (already initialized in initializeCharts)
            // Just ensure it's updated with current data
            if (flPerformanceChart) {
                flPerformanceChart.data.datasets[1].data[3] = dummyData.accuracy;
                flPerformanceChart.update();
            }
            
            // Initialize FL report
            const flReportContent = document.getElementById('flReportContent');
            if (flReportContent) {
                flReportContent.innerHTML = `
                    <div class="report-section">
                        <h4>Federated Learning System Status - ${dummyData.name}</h4>
                        <p><strong>Current Round:</strong> #${dummyData.flRounds}</p>
                        <p><strong>Global Model Accuracy:</strong> ${dummyData.accuracy}%</p>
                        <p><strong>Privacy Protection:</strong> Îµ=1.2 (Strong differential privacy)</p>
                    </div>
                    
                    <div class="report-section">
                        <h4>Node Contributions</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Country Node</th>
                                    <th>Data Contribution</th>
                                    <th>Local Accuracy</th>
                                    <th>Privacy Level</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Nepal</td>
                                    <td>Snowmelt patterns, mountain rainfall</td>
                                    <td>88.5%</td>
                                    <td style="color: #28a745;">Îµ=1.3</td>
                                    <td><span class="status-indicator status-active"></span> Active</td>
                                </tr>
                                <tr>
                                    <td>India</td>
                                    <td>River flows, reservoir data</td>
                                    <td>90.8%</td>
                                    <td style="color: #28a745;">Îµ=1.1</td>
                                    <td><span class="status-indicator status-training"></span> Training</td>
                                </tr>
                                <tr>
                                    <td>Bangladesh</td>
                                    <td>Flood impacts, damage reports</td>
                                    <td>92.1%</td>
                                    <td style="color: #28a745;">Îµ=1.4</td>
                                    <td><span class="status-indicator status-active"></span> Active</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h4>Privacy-Preserving Mechanisms</h4>
                        <div class="highlight-card">
                            <h5>Differential Privacy (Îµ=1.2)</h5>
                            <p>Controlled noise added to model updates to prevent reverse engineering of training data. This ensures that individual data points cannot be identified from the shared model parameters.</p>
                        </div>
                        <div class="highlight-card">
                            <h5>Secure Aggregation</h5>
                            <p>Model updates are encrypted before transmission and only decrypted after aggregation. No single party can access individual model updates from other countries.</p>
                        </div>
                        <div class="highlight-card">
                            <h5>Local Data Sovereignty</h5>
                            <p>Raw hydrological data never leaves national borders. Each country maintains complete control over their sensitive water data while contributing to basin-wide predictions.</p>
                        </div>
                    </div>
                    
                    <div class="report-section">
                        <h4>Performance Benefits</h4>
                        <ul>
                            <li><strong>Accuracy:</strong> Federated model achieves ${dummyData.accuracy}% accuracy (only 0.9% less than centralized model with data sharing)</li>
                            <li><strong>Lead Time:</strong> Warning lead time improved by 8.2 hours compared to country-specific models</li>
                            <li><strong>Coverage:</strong> Enables transboundary flood forecasting without compromising data sovereignty</li>
                            <li><strong>Trust:</strong> Builds trust between countries through transparent, privacy-preserving collaboration</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // Initialize building-related charts
        function initializeBuildingCharts() {
            // Building Damage Chart
            const buildingDamageCtx = document.getElementById('buildingDamageChart');
            if (buildingDamageCtx) {
                try {
                    buildingDamageChart = new Chart(buildingDamageCtx.getContext('2d'), {
                        type: 'bar',
                        data: {
                            labels: ['Residential', 'Commercial', 'Industrial', 'Public'],
                            datasets: [{
                                label: 'Estimated Damage ($ Millions)',
                                data: [
                                    dummyData.buildingsAtRisk * 0.85 * 1500 / 1000000,
                                    dummyData.buildingsAtRisk * 0.10 * 2500 / 1000000,
                                    dummyData.buildingsAtRisk * 0.03 * 5000 / 1000000,
                                    dummyData.buildingsAtRisk * 0.02 * 2000 / 1000000
                                ],
                                backgroundColor: [
                                    'rgba(87, 197, 182, 0.8)',
                                    'rgba(255, 152, 0, 0.8)',
                                    'rgba(108, 117, 125, 0.8)',
                                    'rgba(57, 192, 237, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(87, 197, 182, 1)',
                                    'rgba(255, 152, 0, 1)',
                                    'rgba(108, 117, 125, 1)',
                                    'rgba(57, 192, 237, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Damage ($ Millions)'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Estimated Building Damage by Type'
                                }
                            }
                        }
                    });
                    console.log("Building damage chart initialized");
                } catch (error) {
                    console.error('Error initializing buildingDamageChart:', error);
                }
            }
            
            // Building Type Chart
            const buildingTypeCtx = document.getElementById('buildingTypeChart');
            if (buildingTypeCtx) {
                try {
                    buildingTypeChart = new Chart(buildingTypeCtx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: ['Residential', 'Commercial', 'Industrial', 'Public'],
                            datasets: [{
                                data: [
                                    dummyData.buildingsAtRisk * 0.85,
                                    dummyData.buildingsAtRisk * 0.10,
                                    dummyData.buildingsAtRisk * 0.03,
                                    dummyData.buildingsAtRisk * 0.02
                                ],
                                backgroundColor: [
                                    'rgba(87, 197, 182, 0.8)',
                                    'rgba(255, 152, 0, 0.8)',
                                    'rgba(108, 117, 125, 0.8)',
                                    'rgba(57, 192, 237, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(87, 197, 182, 1)',
                                    'rgba(255, 152, 0, 1)',
                                    'rgba(108, 117, 125, 1)',
                                    'rgba(57, 192, 237, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Building Type Distribution in Flood Zone'
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 20
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.raw || 0;
                                            const percentage = Math.round((value / dummyData.buildingsAtRisk) * 100);
                                            return `${label}: ${Math.round(value).toLocaleString()} buildings (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    console.log("Building type chart initialized");
                } catch (error) {
                    console.error('Error initializing buildingTypeChart:', error);
                }
            }
        }
        
        // Initialize timeline chart for map tab
        function initializeTimelineChart() {
            const timelineCtx = document.getElementById('timelineChart');
            if (timelineCtx) {
                try {
                    timelineChart = new Chart(timelineCtx.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['Now', '+12h', '+24h', '+36h', '+48h', '+60h', '+72h', '+84h', '+96h'],
                            datasets: [
                                {
                                    label: `${dummyData.name} - High Risk`,
                                    data: [0.5, 0.8, 1.2, 1.6, dummyData.maxDepth * 0.7, dummyData.maxDepth * 0.85, dummyData.maxDepth, dummyData.maxDepth * 0.9, dummyData.maxDepth * 0.7],
                                    borderColor: 'rgba(230, 57, 70, 1)',
                                    backgroundColor: 'rgba(230, 57, 70, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.3
                                },
                                {
                                    label: `${dummyData.name} - Medium Risk`,
                                    data: [0.3, 0.5, 0.9, 1.3, dummyData.maxDepth * 0.5, dummyData.maxDepth * 0.65, dummyData.maxDepth * 0.8, dummyData.maxDepth * 0.7, dummyData.maxDepth * 0.5],
                                    borderColor: 'rgba(255, 152, 0, 1)',
                                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                                    borderWidth: 2,
                                    fill: false,
                                    tension: 0.3
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: dummyData.maxDepth * 1.2,
                                    title: {
                                        display: true,
                                        text: 'Flood Depth (meters)'
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return value + 'm';
                                        }
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Time from Now (hours)'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Predicted Flood Depth Timeline'
                                }
                            }
                        }
                    });
                    console.log("Timeline chart initialized");
                } catch (error) {
                    console.error('Error initializing timelineChart:', error);
                }
            }
        }
        
        // Initialize fairness chart separately
        function initializeFairnessChart() {
            // Fairness chart is already initialized in initializeCharts
            // Just ensure it's updated with current data
            if (fairnessChart) {
                // Adjust fairness data based on region
                const generalPop = Math.max(70, 100 - Math.abs(dummyData.fairnessScore - 85));
                const vulnerablePop = Math.max(60, generalPop - 15);
                
                fairnessChart.data.datasets[0].data = [generalPop - 5, generalPop - 10, generalPop - 12, generalPop - 8, generalPop - 11];
                fairnessChart.data.datasets[1].data = [vulnerablePop, vulnerablePop - 2, vulnerablePop + 1, vulnerablePop - 3, vulnerablePop - 5];
                fairnessChart.update();
            }
        }
        
        // Setup event handlers for buttons
        function setupEventHandlers() {
            // Dashboard buttons
            document.getElementById('generateReport')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('dashboard_summary'), 500);
            });
            
            document.getElementById('simulateFlood')?.addEventListener('click', function() {
                simulateNewFloodScenario();
            });
            
            document.getElementById('testWarnings')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('warning_test'), 500);
            });
            
            document.getElementById('refreshData')?.addEventListener('click', function() {
                refreshLiveData();
            });
            
            // Map buttons
            document.getElementById('updateMap')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('map_update'), 500);
            });
            
            document.getElementById('exportMap')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('map_export'), 500);
            });
            
            document.getElementById('simulateRainfall')?.addEventListener('click', function() {
                simulateRainfallScenario();
            });
            
            // Warning system buttons
            document.getElementById('sendSMS')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('sms_alerts'), 500);
            });
            
            document.getElementById('generateResponsePlan')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('response_plan'), 1000);
            });
            
            document.getElementById('generateEconomicReport')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('economic_impact'), 1000);
            });
            
            document.getElementById('sendWarnings')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('full_warning_system'), 1000);
            });
            
            document.getElementById('createCustomWarning')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('custom_warning'), 500);
            });
            
            document.getElementById('viewWarningHistory')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('warning_history'), 500);
            });
            
            // Building exposure buttons
            document.getElementById('analyzeBuildings')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('building_analysis'), 1000);
            });
            
            document.getElementById('exportBuildingData')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('building_data_export'), 500);
            });
            
            document.getElementById('prioritizeEvacuation')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('evacuation_priorities'), 1000);
            });
            
            // Federated learning buttons
            document.getElementById('trainModel')?.addEventListener('click', function() {
                simulateFederatedLearningRound();
            });
            
            document.getElementById('viewModelDetails')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('model_performance'), 500);
            });
            
            document.getElementById('privacyAudit')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('privacy_audit'), 1000);
            });
            
            // Analytical Graphs buttons - FIXED
            document.getElementById('refreshAnalytics')?.addEventListener('click', function() {
                showNotification('Refreshing Analytics', 'Updating analytical graphs with latest data...', 'info');
                setTimeout(() => {
                    if (analyticalCharts.stateExposureChart) {
                        analyticalCharts.stateExposureChart.data.datasets[0].data = analyticalCharts.stateExposureChart.data.datasets[0].data.map(value => 
                            Math.max(10, Math.min(50, value + (Math.random() * 5 - 2.5)))
                        );
                        analyticalCharts.stateExposureChart.update();
                    }
                    
                    if (analyticalCharts.districtPopulationChart) {
                        analyticalCharts.districtPopulationChart.data.datasets[0].data = analyticalCharts.districtPopulationChart.data.datasets[0].data.map(value => 
                            Math.max(5, value + (Math.random() * 10 - 5))
                        );
                        analyticalCharts.districtPopulationChart.update();
                    }
                    
                    showNotification('Analytics Updated', 'All analytical graphs refreshed with latest data', 'success');
                }, 1000);
            });
            
            document.getElementById('exportAnalyticsData')?.addEventListener('click', function() {
                showNotification('Exporting Data', 'Preparing analytics data for download as CSV...', 'info');
                setTimeout(() => {
                    showNotification('Data Exported', 'Analytics data downloaded as flood_analytics.csv', 'success');
                }, 1500);
            });
            
            document.getElementById('generateAnalyticsReport')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('analytics_report'), 500);
            });
            
            // Evacuation Planning buttons
            document.getElementById('generateEvacuationPlan')?.addEventListener('click', function() {
                showNotification('Generating Evacuation Plan', 'AI is analyzing flood data, population distribution, and road networks to create optimal evacuation plan...', 'info');
                setTimeout(() => {
                    showNotification('Evacuation Plan Generated', `AI has created detailed evacuation plan for ${Math.floor(dummyData.peopleAtRisk * 0.8).toLocaleString()} people`, 'success');
                }, 2000);
            });
            
            document.getElementById('simulateEvacuation')?.addEventListener('click', function() {
                showNotification('Simulating Evacuation', 'Running simulation of evacuation process...', 'info');
                setTimeout(() => {
                    showNotification('Evacuation Simulation Complete', 'Simulation shows 78% evacuation completion within 36 hours, 92% within 48 hours', 'success');
                }, 2500);
            });
            
            document.getElementById('exportEvacuationPlan')?.addEventListener('click', function() {
                showNotification('Exporting Evacuation Plan', 'Preparing detailed evacuation plan PDF for emergency responders...', 'info');
                setTimeout(() => {
                    showNotification('Plan Exported', 'Evacuation plan downloaded as evacuation_plan.pdf', 'success');
                }, 1500);
            });
            
            // Fairness analytics buttons
            document.getElementById('runFairnessCheck')?.addEventListener('click', function() {
                runFairnessAudit();
            });
            
            document.getElementById('applyFairnessFix')?.addEventListener('click', function() {
                applyFairnessImprovements();
            });
            
            document.getElementById('generateEquityReport')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('equity_report'), 500);
            });
            
            // Reports buttons
            document.getElementById('generateNewReport')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('custom_report'), 500);
            });
            
            document.getElementById('downloadReports')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('reports_download'), 500);
            });
            
            document.getElementById('scheduleReports')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('report_scheduling'), 500);
            });
            
            // Data sources buttons
            document.getElementById('checkDataQuality')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('data_quality_check'), 1000);
            });
            
            document.getElementById('updateDataSources')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('data_source_update'), 500);
            });
            
            document.getElementById('dataPrivacyAudit')?.addEventListener('click', function() {
                setTimeout(() => generateDetailedReport('data_privacy_audit'), 1000);
            });
            
            // Geocode button
            document.getElementById('geocodeButton')?.addEventListener('click', performGeocoding);
        }
        
        // Setup report modal functionality
        function setupReportModal() {
            const modal = document.getElementById('reportModal');
            const closeModal = document.getElementById('closeModal');
            const closeReportBtn = document.getElementById('closeReportBtn');
            const downloadReportBtn = document.getElementById('downloadReportBtn');
            
            if (closeModal) closeModal.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            if (closeReportBtn) closeReportBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            if (downloadReportBtn) downloadReportBtn.addEventListener('click', () => {
                showNotification('ðŸ“¥ Downloading Report...', 'Report download started. The PDF file will be saved to your downloads folder.', 'success');
                modal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            if (modal) modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Enhance existing event handlers to generate detailed reports
        function enhanceEventHandlers() {
            // Already handled in setupEventHandlers
        }
        
        // Simulate new flood scenario
        function simulateNewFloodScenario() {
            // Update dummy data with random variations
            dummyData.accuracy = Math.min(99, (dummyData.accuracy + (Math.random() * 0.5 - 0.25)));
            dummyData.leadTime = Math.max(30, dummyData.leadTime + (Math.random() * 2 - 1));
            dummyData.buildingsAtRisk = Math.floor(dummyData.buildingsAtRisk * (0.9 + Math.random() * 0.2));
            dummyData.activeWarnings = Math.floor(2 + Math.random() * 3);
            dummyData.peopleAtRisk = Math.floor(dummyData.buildingsAtRisk * 5);
            dummyData.maxDepth = Math.max(1, dummyData.maxDepth + (Math.random() * 0.5 - 0.25));
            dummyData.flRounds += 1;
            
            updateDashboardMetrics();
            updateChartsForRegion();
            updateAllTabContent();
            
            showNotification(
                'ðŸŒ§ï¸ Simulating New Flood Scenario...',
                `New flood scenario simulated for: ${dummyData.name}\nPredicted flood depth: ${dummyData.maxDepth.toFixed(1)} meters\nBuildings at risk: ${dummyData.buildingsAtRisk.toLocaleString()}\nPeople at risk: ${dummyData.peopleAtRisk.toLocaleString()}\n\nAI model is updating predictions...`,
                'warning'
            );
        }
        
        // Simulate rainfall scenario
        function simulateRainfallScenario() {
            const rainfallAmount = (100 + Math.random() * 300).toFixed(0);
            
            showNotification(
                'ðŸŒ§ï¸ Simulating Rainfall Scenario...',
                `Simulating heavy rainfall: ${rainfallAmount}mm in 24 hours\nRiver levels rising by ${(dummyData.maxDepth * 0.3).toFixed(1)}-${(dummyData.maxDepth * 0.5).toFixed(1)}m\nNew flood warnings generated\nAI model recalculating predictions...`,
                'info'
            );
        }
        
        // Simulate federated learning round
        function simulateFederatedLearningRound() {
            // Update metrics
            dummyData.accuracy = Math.min(99, (dummyData.accuracy + 0.15));
            dummyData.leadTime = Math.min(72, dummyData.leadTime + 0.5);
            dummyData.flRounds += 1;
            
            // Update charts
            if (flPerformanceChart) {
                flPerformanceChart.data.datasets[1].data[3] = dummyData.accuracy;
                flPerformanceChart.update();
            }
            
            updateDashboardMetrics();
            
            showNotification(
                'ðŸ§  Running Federated Learning Round...',
                `Step 1: Nepal trains model on snowmelt data âœ“\nStep 2: India trains model on river flow data âœ“\nStep 3: Bangladesh trains model on flood impact data âœ“\nStep 4: Secure model aggregation âœ“\n\nNew model accuracy: ${dummyData.accuracy.toFixed(1)}% (Privacy: 100%)`,
                'success'
            );
        }
        
        // Run fairness audit
        function runFairnessAudit() {
            // Simulate finding some disparities
            dummyData.warningTimeDiff = -(1.5 + Math.random() * 2).toFixed(1);
            dummyData.missedWarningRate = (3 + Math.random() * 3).toFixed(1);
            dummyData.comprehensionGap = -(15 + Math.random() * 10).toFixed(0);
            dummyData.evacuationRateDiff = -(10 + Math.random() * 8).toFixed(0);
            dummyData.damageAccuracyDiff = -(0.1 + Math.random() * 0.2).toFixed(2);
            dummyData.fairnessScore = Math.floor(70 + Math.random() * 15);
            
            updateDashboardMetrics();
            updateFairnessAnalyticsContent();
            
            showNotification(
                'âš–ï¸ Running Equity Audit...',
                `Audit complete. Key findings:\nâ€¢ Warning time gap: ${dummyData.warningTimeDiff} hours for vulnerable communities\nâ€¢ Missed warnings: +${dummyData.missedWarningRate}% in remote areas\nâ€¢ Message comprehension gap: ${dummyData.comprehensionGap}%\nâ€¢ Overall fairness score: ${dummyData.fairnessScore}/100\n\nClick "Apply Fairness Improvements" to fix.`,
                'warning'
            );
        }
        
        // Apply fairness improvements
        function applyFairnessImprovements() {
            // Simulate improvements
            dummyData.warningTimeDiff = -(0.5 + Math.random() * 1).toFixed(1);
            dummyData.missedWarningRate = (1 + Math.random() * 2).toFixed(1);
            dummyData.comprehensionGap = -(5 + Math.random() * 5).toFixed(0);
            dummyData.evacuationRateDiff = -(3 + Math.random() * 4).toFixed(0);
            dummyData.damageAccuracyDiff = -(0.05 + Math.random() * 0.1).toFixed(2);
            dummyData.fairnessScore = Math.floor(85 + Math.random() * 10);
            
            updateDashboardMetrics();
            updateFairnessAnalyticsContent();
            
            showNotification(
                'âœ¨ Applying Equity Improvements...',
                `Improvements applied successfully:\nâ€¢ Warning time gap reduced to ${dummyData.warningTimeDiff} hours\nâ€¢ Missed warnings reduced by 3.7%\nâ€¢ Message comprehension improved by 12%\nâ€¢ Overall fairness score: ${dummyData.fairnessScore}/100 (Good)\n\nAll communities now receive more equitable warnings.`,
                'success'
            );
        }
        
        // Update dashboard metrics
        function updateDashboardMetrics() {
            // Update metrics grid
            const accuracyMetric = document.getElementById('accuracyMetric');
            const leadTimeMetric = document.getElementById('leadTimeMetric');
            const buildingsMetric = document.getElementById('buildingsMetric');
            
            if (accuracyMetric) accuracyMetric.textContent = dummyData.accuracy.toFixed(1) + '%';
            if (leadTimeMetric) leadTimeMetric.textContent = dummyData.leadTime.toFixed(1) + ' hrs';
            if (buildingsMetric) buildingsMetric.textContent = (dummyData.buildingsAtRisk / 1000).toFixed(1) + 'K';
            
            // Update dashboard cards
            const activeWarnings = document.getElementById('activeWarnings');
            const peopleRisk = document.getElementById('peopleRisk');
            const maxDepth = document.getElementById('maxDepth');
            const flRounds = document.getElementById('flRounds');
            
            if (activeWarnings) activeWarnings.textContent = dummyData.activeWarnings + ' regions';
            if (peopleRisk) peopleRisk.textContent = '~' + dummyData.peopleAtRisk.toLocaleString();
            if (maxDepth) maxDepth.textContent = dummyData.maxDepth.toFixed(1) + ' meters';
            if (flRounds) flRounds.textContent = dummyData.flRounds + ' completed';
            
            // Update vulnerability area
            const vulnerableArea = document.getElementById('vulnerableArea');
            if (vulnerableArea) {
                if (currentCountry === 'bangladesh') {
                    vulnerableArea.textContent = 'Char communities, Northern districts';
                } else if (currentCountry === 'india') {
                    vulnerableArea.textContent = 'Riverine communities, Bihar/West Bengal';
                } else if (currentCountry === 'nepal') {
                    vulnerableArea.textContent = 'Mountain communities, river valleys';
                }
            }
            
            updateLastUpdateTime();
        }
        
        // Refresh live data
        function refreshLiveData() {
            // Simulate small changes to data
            dummyData.accuracy += (Math.random() * 0.1 - 0.05);
            dummyData.accuracy = Math.min(99, Math.max(90, dummyData.accuracy));
            
            dummyData.leadTime += (Math.random() * 0.5 - 0.25);
            dummyData.leadTime = Math.min(72, Math.max(30, dummyData.leadTime));
            
            dummyData.buildingsAtRisk += Math.floor(Math.random() * 1000 - 500);
            dummyData.buildingsAtRisk = Math.max(50000, dummyData.buildingsAtRisk);
            
            dummyData.peopleAtRisk = Math.floor(dummyData.buildingsAtRisk * 5);
            
            updateDashboardMetrics();
            
            showNotification('ðŸ”„ Refreshing Live Data...', 'Updated satellite imagery, river gauge readings, rainfall data, and building footprints. All metrics updated with latest information.', 'success');
        }
        
        // Start live data simulation
        function startLiveDataSimulation() {
            // Update data every 30 seconds
            liveDataInterval = setInterval(() => {
                // Small random changes to simulate live data
                dummyData.accuracy += (Math.random() * 0.05 - 0.025);
                dummyData.accuracy = Math.min(99, Math.max(90, dummyData.accuracy));
                
                dummyData.leadTime += (Math.random() * 0.2 - 0.1);
                dummyData.leadTime = Math.min(72, Math.max(30, dummyData.leadTime));
                
                updateDashboardMetrics();
                
                // Randomly trigger alerts occasionally
                if (Math.random() < 0.1) {
                    const alertTypes = ['info', 'warning', 'success'];
                    const randomAlert = alertTypes[Math.floor(Math.random() * alertTypes.length)];
                    const messages = [
                        'Satellite data update received',
                        'River gauge reporting rate improved',
                        'New building footprints processed',
                        'Federated learning round completed'
                    ];
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    
                    showNotification('ðŸ“¡ Data Update', randomMessage, randomAlert);
                }
            }, 30000);
        }
        
        // Update last update time
        function updateLastUpdateTime() {
            lastUpdateTime = new Date();
            const timeString = lastUpdateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const lastUpdateElement = document.getElementById('lastUpdate');
            if (lastUpdateElement) {
                lastUpdateElement.textContent = timeString;
            }
        }
        
        // Setup AI assistant
        function setupAIAssistant() {
            const aiAssistant = document.getElementById('aiAssistant');
            const closeChat = document.getElementById('closeChat');
            const sendChat = document.getElementById('sendChat');
            const chatInput = document.getElementById('chatInput');
            
            if (aiAssistant) aiAssistant.addEventListener('click', function() {
                const chatBox = document.getElementById('aiChat');
                if (chatBox) {
                    chatBox.style.display = chatBox.style.display === 'block' ? 'none' : 'block';
                }
            });
            
            if (closeChat) closeChat.addEventListener('click', function() {
                const chatBox = document.getElementById('aiChat');
                if (chatBox) {
                    chatBox.style.display = 'none';
                }
            });
            
            // Chat functionality
            if (sendChat) sendChat.addEventListener('click', sendChatMessage);
            if (chatInput) chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Add sample chat messages
            addChatMessage('ai', 'Hello! I\'m your flood forecasting AI assistant. I can help you understand flood risks, check system status, or explain how federated learning works. How can I help you today?');
        }
        
        // Chat functionality
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage('user', message);
                input.value = '';
                
                // AI responses
                setTimeout(() => {
                    let response = '';
                    const lowerMessage = message.toLowerCase();
                    
                    if (lowerMessage.includes('building') || lowerMessage.includes('house') || lowerMessage.includes('home')) {
                        response = `Currently, ${dummyData.buildingsAtRisk.toLocaleString()} buildings are at risk in ${dummyData.name}. 85% are residential buildings. Estimated building damage is $${Math.floor(dummyData.buildingsAtRisk * 1500).toLocaleString()}. The system uses OpenStreetMap and Microsoft Building Footprints data to assess vulnerability. Would you like more details about specific building types?`;
                    } else if (lowerMessage.includes('flood') && lowerMessage.includes('risk')) {
                        response = `Currently, there are ${dummyData.activeWarnings} high-risk flood areas in ${dummyData.name}. Predicted flood depth: ${dummyData.maxDepth.toFixed(1)} meters within 48-72 hours. ${dummyData.buildingsAtRisk.toLocaleString()} buildings are at risk. Would you like more details about a specific area?`;
                    } else if (lowerMessage.includes('federated') || lowerMessage.includes('privacy')) {
                        response = 'Federated Learning allows India, Nepal, and Bangladesh to train a shared AI model WITHOUT sharing their sensitive water data. Each country trains the model locally, then only shares the improved model parameters (not the raw data). This preserves national data sovereignty while creating accurate basin-wide flood predictions. Differential privacy adds noise to protect individual data points.';
                    } else if (lowerMessage.includes('warning') || lowerMessage.includes('alert')) {
                        response = `We have active warnings for ${dummyData.activeWarnings} regions in ${dummyData.name}. ${dummyData.peopleAtRisk.toLocaleString()} people and ${dummyData.buildingsAtRisk.toLocaleString()} buildings are at risk. Warnings are sent via SMS, radio, loudspeakers, and mobile apps. We use simple icon-based warnings for low-literacy communities.`;
                    } else if (lowerMessage.includes('fair') || lowerMessage.includes('equity')) {
                        response = `Our system automatically checks if warnings reach everyone equally, especially vulnerable communities. Current fairness score for ${dummyData.name} is ${dummyData.fairnessScore}/100. We monitor warning times for remote communities and fix any biases automatically.`;
                    } else if (lowerMessage.includes('accuracy') || lowerMessage.includes('how good')) {
                        response = `The federated AI model predicts floods with ${dummyData.accuracy.toFixed(1)}% accuracy for ${dummyData.name}. Building damage prediction accuracy is 89%. Warning lead time has improved by 8.2 hours compared to country-specific models. The model improves with each federated learning round.`;
                    } else if (lowerMessage.includes('help')) {
                        response = 'I can help you with:\nâ€¢ Current flood risks and warnings\nâ€¢ Building exposure analysis\nâ€¢ How federated learning protects privacy\nâ€¢ Fairness checks for vulnerable communities\nâ€¢ Understanding AI predictions\nâ€¢ Generating reports for different users\nâ€¢ Data sources and integration\n\nJust ask me anything about flood forecasting!';
                    } else if (lowerMessage.includes('research') || lowerMessage.includes('dphil')) {
                        response = 'This prototype demonstrates my DPhil research on "Federated and Fair Flood Forecasting". The research investigates whether privacy-preserving AI (federated learning) can improve transboundary flood warnings while respecting data sovereignty and ensuring equitable warning distribution, especially for vulnerable communities in the GBM basin.';
                    } else if (lowerMessage.includes('evacuation') || lowerMessage.includes('shelter')) {
                        response = `The evacuation planning module prioritizes vulnerable communities using AI logic. Currently, ${Math.floor(dummyData.peopleAtRisk * 0.8).toLocaleString()} people require evacuation in ${dummyData.name}. We have ${Math.floor(dummyData.peopleAtRisk/10000)} shelters activated. Priority 1 evacuation must be completed within 24 hours.`;
                    } else if (lowerMessage.includes('region') || lowerMessage.includes('basin') || lowerMessage.includes('country')) {
                        response = `You are currently viewing data for ${dummyData.name}. You can change the region using the dropdown filters at the top. Available options: Ganga, Brahmaputra, or Meghna basins in India, Bangladesh, or Nepal.`;
                    } else {
                        response = `I understand you're asking about: "${message}". As an AI assistant for flood forecasting research, I can tell you about current flood risks in ${dummyData.name}, building exposure analysis, how our privacy-protecting system works, or help you understand warnings for different communities. Could you rephrase your question about flood forecasting?`;
                    }
                    
                    addChatMessage('ai', response);
                }, 1000);
            }
        }
        
        function addChatMessage(sender, text) {
            const chatBody = document.getElementById('chatBody');
            if (!chatBody) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'ai-message user-message' : 'ai-message';
            messageDiv.textContent = text;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // Store message
            chatMessages.push({sender, text});
        }
        
        // Show notification
        function showNotification(title, message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${type === 'warning' ? 'var(--warning-red)' : type === 'success' ? '#28a745' : 'var(--primary-blue)'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 2000;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">${message.replace(/\n/g, '<br>')}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
            
            // Add CSS for animations
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // Generate detailed report based on action type
        function generateDetailedReport(reportType) {
            const reportContent = document.getElementById('modalReportContent');
            const modal = document.getElementById('reportModal');
            
            if (!reportContent || !modal) return;
            
            let reportHTML = '';
            const timestamp = new Date().toLocaleString();
            
            switch(reportType) {
                case 'dashboard_summary':
                    reportHTML = generateDashboardSummaryReport(timestamp);
                    break;
                default:
                    reportHTML = generateDefaultReport(timestamp);
            }
            
            reportContent.innerHTML = reportHTML;
            modal.style.display = 'flex';
        }
        
        // Report generation functions
        function generateDashboardSummaryReport(timestamp) {
            return `<div class="detailed-report">
                <div class="report-section">
                    <h4><i class="fas fa-tachometer-alt"></i> System Dashboard Summary Report - ${dummyData.name}</h4>
                    <p><strong>Report ID:</strong> DASH-SUMMARY-${Date.now()}</p>
                    <p><strong>Generated:</strong> ${timestamp}</p>
                </div>
                <div class="report-section">
                    <h4>System Status for ${dummyData.name}</h4>
                    <p>All systems operational. Federated learning model accuracy: ${dummyData.accuracy.toFixed(1)}%.</p>
                    <p><strong>Key Metrics:</strong></p>
                    <div class="report-highlights">
                        <div class="highlight-box">
                            <h5>Model Accuracy</h5>
                            <p><strong>${dummyData.accuracy.toFixed(1)}%</strong></p>
                            <p>Federated learning performance</p>
                        </div>
                        <div class="highlight-box">
                            <h5>Warning Lead Time</h5>
                            <p><strong>${dummyData.leadTime.toFixed(1)} hrs</strong></p>
                            <p>Average advance warning</p>
                        </div>
                        <div class="highlight-box">
                            <h5>Buildings at Risk</h5>
                            <p><strong>${dummyData.buildingsAtRisk.toLocaleString()}</strong></p>
                            <p>In flood zone</p>
                        </div>
                    </div>
                </div>
            </div>`;
        }
        
        function generateDefaultReport(timestamp) {
            return `<div class="detailed-report">
                <div class="report-section">
                    <h4><i class="fas fa-file-alt"></i> AI-Generated Analysis Report - ${dummyData.name}</h4>
                    <p><strong>Report ID:</strong> AI-REPORT-${Date.now()}</p>
                    <p><strong>Generated:</strong> ${timestamp}</p>
                </div>
                <div class="report-section">
                    <h4>Report Summary for ${dummyData.name}</h4>
                    <p>This report has been automatically generated by the Flood Forecasting AI Assistant for the selected region: ${dummyData.name}.</p>
                    <p><strong>Current Status:</strong></p>
                    <ul>
                        <li>Flood Risk Level: ${dummyData.maxDepth > 2 ? 'HIGH' : dummyData.maxDepth > 1 ? 'MEDIUM' : 'LOW'}</li>
                        <li>Predicted Flood Depth: ${(dummyData.maxDepth - 0.3).toFixed(1)}-${dummyData.maxDepth.toFixed(1)} meters</li>
                        <li>People at Risk: ${dummyData.peopleAtRisk.toLocaleString()}</li>
                        <li>Buildings at Risk: ${dummyData.buildingsAtRisk.toLocaleString()}</li>
                        <li>AI Model Accuracy: ${dummyData.accuracy.toFixed(1)}%</li>
                    </ul>
                </div>
            </div>`;
        }
        
        // Initialize with a flood animation
        setTimeout(() => {
            const alertBox = document.querySelector('.alert-box.warning');
            if (alertBox) {
                alertBox.style.animation = 'pulse 2s 3';
            }
        }, 1000);
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApplication);
    </script>
</body>
</html>

